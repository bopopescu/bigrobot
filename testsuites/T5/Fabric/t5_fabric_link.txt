== T5 Fabric Link Test ==

*Settings
Documentation    Fabric Link Formation Dual Rack Dual Spine Test
Suite Setup      base suite setup
Suite Teardown   base suite teardown
Test Setup       base test setup
Test Teardown    base test teardown
Force Tags       T5 
Library          keywords/BsnCommon.py
Library          keywords/T5.py
Library          keywords/T5Fabric.py

Library			 keywords/SwitchLight.py
Resource         testsuites/T5/t5_dualleaf_three_rack_physical_resource.txt
Resource		 testsuites/T5/t5_physical_variables.txt


*Test Case

Setup Three Rack Dual Leaf Topology
	base suite setup  
    add fabric switch
    sleep  5
    rest verify fabric switch all
   
Verify Fabric link formation
	[Tags]  feature  
	REST verify fabric link 	

delete/add one of the spine Fabric Role and verify the link
	[Tags]	feature  
	REST delete fabric role  spine     
    sleep  5 
	REST verify fabric link
	REST add fabric role   spine0   spine      
    sleep  5 
	REST verify fabric link   
	
delete one of the leaf in Dual Leaf setup and verify the link
    rest delete fabric role  leaf
    rest delete leaf group  leaf0-a
    sleep  5
    rest verify fabric link
    sleep  5
    rest add fabric role  leaf0-a  leaf
    rest add leaf group  leaf0-a  rack0
    sleep  5
    rest verify fabric link
    
Reboot spine switch spine1 and verify the fabric link
	[Tags]  feature
	rest verify fabric link
	cli restart switch  spine1
	sleep  3
	rest verify fabric link
	sleep  10
	rest verify fabric link
Reboot leaf switch and verify fabric link
	[Tags]  feature
	rest verify fabric link
	cli restart switch  leaf0-a
	sleep  3
	rest verify fabric link
	sleep  10
	rest verify fabric link
	
Add/delete a new link between spine0 and leaf0a
	[Tags]  feature
	rest verify fabric link
	cli disable interface  leaf0-a  ${leaf0a_spine0_intf0}
	rest verify fabric link
	cli enable interface  leaf0-a  ${leaf0a_spine0_intf0}
	sleep  2
	rest verify fabric link

add and delete peer group link and verify the database
	[Tags]  feature
	rest verify fabric link
	cli disable interface  leaf1-a  ${leaf1a_leaf1b_intf0}
	rest verify fabric link
	cli enable interface  leaf1-a  ${leaf1a_leaf1b_intf0}
	rest verify fabric link

Delete and Readd the Rack2
	[Tags]  feature
	rest delete fabric switch  leaf2-a
	rest delete fabric switch  leaf2-b
	sleep  2
	rest verify fabric link
	rest add switch  leaf2-a
	rest add dpid  leaf2-a  ${leaf2a_dpid}
	rest add fabric role  leaf2-a  leaf
	rest add leaf group  leaf2-a  rack2
	sleep  5
	rest verify fabric link
	rest add switch  leaf2-b
	rest add dpid  leaf2-b  ${leaf2b_dpid}
	rest add fabric role  leaf2-b  leaf
	rest add leaf group  leaf2-b  rack2
	sleep  5
	rest verify fabric link

add portgroup lacp to 2 different rack
	[Tags]  feature  
	rest delete fabric switch  leaf0-a
	rest delete fabric switch  leaf0-b
	rest add switch  leaf0-a
	rest add dpid  leaf0-a  ${leaf0a_dpid}
	rest add fabric role  leaf0-a  leaf
	rest add leaf group  leaf0-a  rack5
	rest add switch  leaf0-b
	rest add dpid  leaf0-b  ${leaf0b_dpid}
	rest add fabric role  leaf0-b  leaf
	rest add leaf group  leaf0-b  rack6
	sleep  3
	rest add portgroup  p1
	rest add portgroup lacp  p1
	rest add interface to portgroup  leaf0-a  ${h1_intf0}  p1
	${result}=  rest add interface to portgroup  leaf0-b  ${h1_intf1}  p1
	Should not be True  ${result}
	sleep  2
	rest verify fabric interface lacp  leaf0-a  ${h1_intf0}
	rest add portgroup  p2
	rest add portgroup lacp  p2
	rest add interface to portgroup  leaf0-b  ${h1_intf1}  p2
	${result}=  rest verify fabric interface lacp  leaf0-b  ${h1_intf1}
	Should not be True  ${result}
	
Tear down config and Topology
    delete fabric switch  
    rest delete portgroup  p1
    rest delete portgroup  p2
    base suite teardown
 

* Keywords  



    


