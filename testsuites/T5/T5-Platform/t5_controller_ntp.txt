*Settings
Documentation  T5 NTP Test Suite Release:Iron Horse
Suite Setup  ntp suite setup
Suite Teardown   base suite teardown
Test Setup   base test setup
Test Teardown   base test teardown
Force Tags   T5 Platform

Library  keywords/T5.py
Library  keywords/BsnCommon.py

* Variable
${project_string}   Big Virtual Switch Appliance
${version_string}   2.0.5-SNAPSHOT    
    
* Test Case
Configure and Verify Configuration on Master 
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    [Tags]  ntp  verifyconfig

Configure and Verify Configuration on Slave 
    ${status}=  verify ntp  c2  time-c.nist.gov
    Should be true  ${status}
    [Tags]  ntp  verifyconfig    

Delete NTP server and verify 
    ${status}=  delete ntp server  c1  time-c.nist.gov
    Should be true  ${status}
    Sleep  5
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should not be true  ${status}
    [Tags]  ntp  deletentp

Verify Time Zone
    add ntp timezone  c1  America/Los_Angeles
    Sleep  5
    ${status}=  verify timezone  c1  PDT  
    Should be true  ${status}
    [Tags]  ntp  add-timezone  timezone

Verify Time Zone can be changed
    add ntp timezone  c1  America/Los_Angeles
    Sleep  10
    ${status}=  verify timezone  c1  PDT  
    Should be true  ${status}
    Sleep  10
    add ntp timezone  c1  America/New_York
    Sleep  10    
    ${status}=  verify timezone  c1  EDT  
    Should be true  ${status}
    [Tags]  ntp  change-timezone  timezone

Verify deleting NTP TimeZone reverts it to UTC
    add ntp timezone  c1  America/Los_Angeles
    Sleep  5
    ${status}=  verify timezone  c1  PDT  
    Should be true  ${status}
    Sleep  5
    delete ntp timezone  c1
    Sleep  10
    ${status}=  verify timezone  c1  UTC  
    Should be true  ${status} 
    [Tags]  ntp  delete-timezone  timezone


Add multiple NTP servers and verify on Master and Slave
    add ntp server  c1  time-c.nist.gov
    add ntp server  c1  time-d.nist.gov
    add ntp server  c1  nist-time-server.eoni.com
    add ntp timezone  c1  America/Los_Angeles     
    Sleep  5
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  nist-time-server.eoni.com
    Should be true  ${status}
    ${status}=  verify ntp  c2  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  nist-time-server.eoni.com
    Should be true  ${status}
    Sleep  5
    ${status}=  delete ntp server  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  delete ntp server  c1  nist-time-server.eoni.com                         
    [Tags]  ntp  multiple-ntp


With multiple NTP servers, restart process ntp on Master and verify
    add ntp server  c1  time-c.nist.gov
    add ntp server  c1  time-d.nist.gov
    add ntp server  c1  nist-time-server.eoni.com 
    Sleep  5
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  nist-time-server.eoni.com
    Should be true  ${status}
    restart process on controller  ntp  Master
    Sleep  5
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  nist-time-server.eoni.com
    Should be true  ${status}
    Sleep  5
    ${status}=  delete ntp server  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  delete ntp server  c1  nist-time-server.eoni.com
    Should be true  ${status}                                
    [Tags]  ntp  restart-ntp


With multiple NTP servers, restart process ntp on Master and verify Slave is unaffected
    add ntp server  c1  time-c.nist.gov
    add ntp server  c1  time-d.nist.gov
    add ntp server  c1  nist-time-server.eoni.com 
    Sleep  5
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  nist-time-server.eoni.com
    Should be true  ${status}
    restart process on controller  ntp  Master
    ${status}=  verify ntp  c2  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  nist-time-server.eoni.com
    Should be true  ${status}
    Sleep  5
    ${status}=  delete ntp server  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  delete ntp server  c1  nist-time-server.eoni.com
    Should be true  ${status}                                
    [Tags]  ntp  restart-ntp-check-slave


With multiple NTP servers, restart process ntp on Slave and verify Master is unaffected
    add ntp server  c1  time-c.nist.gov
    add ntp server  c1  time-d.nist.gov
    add ntp server  c1  nist-time-server.eoni.com 
    Sleep  5
    ${status}=  verify ntp  c2  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c2  nist-time-server.eoni.com
    Should be true  ${status}
    restart process on controller  ntp  Slave
    ${status}=  verify ntp  c1  time-c.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  verify ntp  c1  nist-time-server.eoni.com
    Should be true  ${status}
    Sleep  5
    ${status}=  delete ntp server  c1  time-d.nist.gov
    Should be true  ${status}
    ${status}=  delete ntp server  c1  nist-time-server.eoni.com
    Should be true  ${status}                                
    [Tags]  ntp  restart-ntp-check-master

       
                            
* Keywords

ntp suite setup
    base suite setup
    add ntp server  c1  time-c.nist.gov
    Sleep  5
    
