*Settings
Documentation  T5 SNMP Test Suite Release:Iron Horse Feature:SNMP
Suite Setup  snmp suite setup
Suite Teardown   snmp suite teardown
Test Setup   base test setup
Test Teardown   base test teardown
Force Tags   T5 SNMP
Library  keywords/BsnCommon.py

* Variable

    
* Test Case
Configure and Verify Configuration  
    verify config
    [Tags]  snmp  verify-configuration  

Verify SNMP OID sysContact on Master  
    ${snmp_key}=  snmp get  master  public  sysContact.0
    Should Contain  ${snmp_key}  Big Switch Networks
    [Tags]  snmp  sysContact  master  

Verify SNMP OID sysContact on Slave  
    ${snmp_key}=  snmp get  slave  public  sysContact.0
    Should Contain  ${snmp_key}  Big Switch Networks
    [Tags]  snmp  sysContact  slave
    
Verify SNMP OID sysLocation on Master  
    ${snmp_key}=  snmp get  master  public  sysLocation.0
    Should Contain  ${snmp_key}  Mountain View
    [Tags]  snmp  sysLocation  master  
    
Verify SNMP OID sysLocation on Slave  
    ${snmp_key}=  snmp get  slave  public  sysLocation.0
    Should Contain  ${snmp_key}  Mountain View
    [Tags]  snmp  sysLocation  slave  
    
Verify SNMP OID sysDescr on Master  
    ${snmp_key}=  snmp get  master  public  sysDescr.0
    Should Contain  ${snmp_key}  Big Virtual Switch Appliance    
    [Tags]  snmp  sysDescr  master
    
Verify SNMP OID sysDescr on Slave  
    ${snmp_key}=  snmp get  slave  public  sysDescr.0
    Should Contain  ${snmp_key}  Big Virtual Switch Appliance    
    [Tags]  snmp  sysDescr  slave  
      
Verify SNMP OID ifDescr on Master  
    ${snmp_key}=  snmp get  master  public  ifDescr.2
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  ifDescr  master
      
Verify SNMP OID ifDescr on Slave  
    ${snmp_key}=  snmp get  slave  public  ifDescr.2
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  ifDescr  slave    
   
Verify SNMP OID ifType on Master  
    ${snmp_key}=  snmp get  master  public  ifType.2
    Should Contain  ${snmp_key}  ethernetCsmacd
    [Tags]  snmp  ifType  master
   
Verify SNMP OID ifType on Slave  
    ${snmp_key}=  snmp get  slave  public  ifType.2
    Should Contain  ${snmp_key}  ethernetCsmacd
    [Tags]  snmp  ifType  master    

Verify SNMP OID ifOperStatus on Master  
    ${snmp_key}=  snmp get  master  public  ifOperStatus.2
    Should Contain  ${snmp_key}  up
    [Tags]  snmp  ifOperStatus  master  

Verify SNMP OID ifOperStatus on Slave  
    ${snmp_key}=  snmp get  slave  public  ifOperStatus.2
    Should Contain  ${snmp_key}  up
    [Tags]  snmp  ifOperStatus  slave  
    
Verify SNMP OID ifAdminStatus on Master   
    ${snmp_key}=  snmp get  master  public  ifAdminStatus.2
    Should Contain  ${snmp_key}  up     
    [Tags]  snmp  ifAdminStatus  master 
    
Verify SNMP OID ifAdminStatus on Slave  
    ${snmp_key}=  snmp get  slave  public  ifAdminStatus.2
    Should Contain  ${snmp_key}  up     
    [Tags]  snmp  ifAdminStatus  slave     

Verify snmpgetnext works as expected on Master
    ${snmp_key}=  snmp getnext  master  public  ifDescr.1
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpgetnext  master
     
Verify snmpgetnext works as expected on Slave
    ${snmp_key}=  snmp getnext  slave  public  ifDescr.1
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpgetnext  slave           
    
verify snmpbulkget works as expected on Master
    ${snmp_key}=  snmp cmd  master  snmpbulkget  public  ifDescr 
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpbulkget  master

verify snmpbulkget works as expected on Slave
    ${snmp_key}=  snmp cmd  slave  snmpbulkget  public  ifDescr 
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpbulkget  slave     

verify snmpbulkwalk works as expected on Master
    ${snmp_key}=  snmp cmd  master  snmpbulkwalk  public  ifDescr 
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpbulkwalk  master   

verify snmpbulkwalk works as expected on Slave
    ${snmp_key}=  snmp cmd  slave  snmpbulkwalk  public  ifDescr 
    Should Contain  ${snmp_key}  eth0
    [Tags]  snmp  snmpbulkwalk  slave  

Restart process SNMP on Master controller and verify snmpget
    restart process on controller  snmpd  master
    Sleep  10    
    ${snmp_key}=  snmp get  master  public  sysDescr.0
    Should Contain  ${snmp_key}  Big Virtual Switch Appliance  
    [Tags]  snmp  process-restart  master  
 
Restart process SNMP on Slave controller and verify snmpget
    restart process on controller  snmpd  slave
    Sleep  10    
    ${snmp_key}=  snmp get  slave  public  sysDescr.0
    Should Contain  ${snmp_key}  Big Virtual Switch Appliance  
    [Tags]  snmp  process-restart  slave 
    
Change community from public to bigswitch and verify snmp walk
    rest add snmp keyword  community  bigswitch
    ${snmp_key}=  snmp get  master  bigswitch  sysDescr.0
    Should Contain  ${snmp_key}  Big Virtual Switch Appliance   
    [Tags]  snmp  

       
* Keywords
snmp suite setup
    rest add snmp keyword  community  public
    rest add snmp keyword  contact  Big Switch Networks
    rest add snmp keyword  location  Mountain View
    rest add snmp keyword  trap-enabled  True
    rest add snmp host  10.192.66.230  162    
    rest add firewall rule  service=snmp
    Sleep  10        

verify config
    ${snmp_output}=  rest show snmp
    ${snmp_key}=  verify json key  ${snmp_output}  0  community  
    Should Be Equal As Strings  ${snmp_key}  public
    ${snmp_key}=  verify json key  ${snmp_output}  0  contact  
    Should Be Equal As Strings  ${snmp_key}  Big Switch Networks        
    ${snmp_key}=  verify json key  ${snmp_output}  0  location  
    Should Be Equal As Strings  ${snmp_key}  Mountain View
    ${snmp_key}=  verify json key  ${snmp_output}  0  trap-enabled  
    Should Be True  ${snmp_key}
    ${snmp_key}=  verify json key  ${snmp_output}  0  trap-host
    ${new_snmp_key}=  verify json key  ${snmp_key}  0  ipaddr      
    Should Be Equal As Strings  ${new_snmp_key}  10.192.66.230
    ${new_snmp_key}=  verify json key  ${snmp_key}  0  udp-port       
    Should Be Equal As Integers  ${new_snmp_key}  162
           
snmp suite teardown
    rest add snmp keyword  community  null
    rest add snmp keyword  contact  null
    rest add snmp keyword  location  null
    rest add snmp keyword  trap-enable  false
    rest delete snmp host  10.192.66.230  162 
    rest delete firewall rule  service=snmp    
    base suite teardown
    
    
