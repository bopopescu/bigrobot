*** Settings ***
Documentation  		Deleting lines from running-config and validating
Suite Setup  		Suite Setup
Suite Teardown   	Suite Teardown
Test Setup   		Test Setup
Test Teardown  		Test Teardown
Force Tags   		Platform  Sanity  running-config  CLI  feature  T5  IronHorse
Library  			keywords/BsnCommon.py
Library  			keywords/T5Platform.py
Library  			keywords/T5Utilities.py
Library  			keywords/T5.py
Library        		String
Library				Collections


*** Variables ***


*** Test Cases ***
T0 Basic check
	Cli Copy  scp://bsn@10.9.16.52:file-management-testsuite/extensive-config  snapshot://extensive-config
	Sleep  5
	Cli Copy  scp://bsn@10.9.16.52:file-management-testsuite/extensive-file  file://extensive-file
	Compare  file://extensive-file  snapshot://extensive-config
	Sleep  5
	Cli Copy  scp://bsn@10.9.16.52:file-management-testsuite/extensive-config  running-config
	Compare  snapshot://extensive-config  running-config
	Compare  file://extensive-file  running-config
	Cli Copy  snapshot://startup-config  running-config
	Sleep  5
	Cli Copy  scp://bsn@10.9.16.52:file-management-testsuite/extensive-file  running-config

T1.1. Deleting ntp time-zone
	${command}=  Set Variable  ntp time-zone America/Los_Angeles
	${diff}=  Create List  ntp time-zone America/Los_Angeles
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T1.2. Deleting ntp time-zone
	${command}=  Set Variable  ntp time-zone XXX
	${diff}=  Create List  ntp time-zone America/Los_Angeles
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T1.3. Deleting ntp time-zone
    ${command}=  Set Variable  ntp time-zone
    ${diff}=  Create List  ntp time-zone America/Los_Angeles
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T2.1. Deleting banner
	${command}=  Set Variable  banner 'Hello To BVS\\nI will be your guide\\nTest 1.2.3 $$'
	${diff}=  Create List
	...  banner 'Hello To BVS\\nI will be your guide\\nTest 1.2.3 $$'
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T2.2. Deleting banner
    ${command}=  Set Variable  banner XXX
    ${diff}=  Create List
    ...  banner 'Hello To BVS\\nI will be your guide\\nTest 1.2.3 $$'
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T2.3. Deleting banner
    ${command}=  Set Variable  banner
    ${diff}=  Create List
    ...  banner 'Hello To BVS\\nI will be your guide\\nTest 1.2.3 $$'
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T3. Deleting logging remote
	${command}=  Set Variable  logging remote
	${diff}=  Create List  logging remote
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T4.1. Deleting logging remote server
    Cli Run  master  logging remote 2.2.2.2; logging remote 3.3.3.3 33
	${command}=  Set Variable  logging remote 1.2.3.4 44
	${diff}=  Create List  logging remote 1.2.3.4 44
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T4.2. Deleting logging remote server
    ${command}=  Set Variable  logging remote 1.2.3.4
    ${diff}=  Create List  logging remote 1.2.3.4 44
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T4.3. Deleting logging remote server
    Cli Run  master  logging remote 3.2.4.2
    ${command}=  Set Variable  logging remote 123.123.123.123
    ${diff}=  Set Variable  ${Empty}
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T4.4. Deleting logging remote server
    Cli Run  master  logging remote 4.3.42.2
    ${command}=  Set Variable  logging remote 4.3.42.2 55
    ${diff}=  Create List  logging remote 4.3.42.2
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T5.1. Deleting snmp-server community ro
	${command}=  Set Variable  snmp-server community ro Test_12-test
	${diff}=  Create List  snmp-server community ro Test_12-test
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T5.2. Deleting snmp-server community ro
    ${command}=  Set Variable  snmp-server community ro XXX
    ${diff}=  Create List  snmp-server community ro Test_12-test
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T5.3. Deleting snmp-server community ro
    ${command}=  Set Variable  snmp-server community ro
    ${diff}=  Create List  snmp-server community ro Test_12-test
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T6.1. Deleting snmp-server contact
	${command}=  Set Variable
	...  snmp-server contact Tomasz@\\0xc5\\0x82\\0xc3\\0xb3d\\0xc5\\0xba.p
	${diff}=  Create List
	...  snmp-server contact Tomasz@\\0xc5\\0x82\\0xc3\\0xb3d\\0xc5\\0xba.pl
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T6.2. Deleting snmp-server contact
    ${command}=  Set Variable  snmp-server contact XXX
    ${diff}=  Create List
    ...  snmp-server contact Tomasz@\\0xc5\\0x82\\0xc3\\0xb3d\\0xc5\\0xba.pl
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T6.3. Deleting snmp-server contact
    ${command}=  Set Variable  snmp-server contact
    ${diff}=  Create List
    ...  snmp-server contact Tomasz@\\0xc5\\0x82\\0xc3\\0xb3d\\0xc5\\0xba.pl
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T7. Deleting snmp-server enable traps
	${command}=  Set Variable  snmp-server enable traps
	${diff}=  Create List  snmp-server enable traps
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T8.1. Deleting snmp-server host
    Cli Run  master  snmp-server host 1.2.3.4 udp-port 12
	${command}=  Set Variable  snmp-server host 4.3.2.1
	${diff}=  Create List  snmp-server host 4.3.2.1
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T8.2. Deleting snmp-server host
    Cli Run  master  snmp-server host 1.2.3.4 udp-port 12
    ${command}=  Set Variable  snmp-server host XXX
    ${diff}=  Set Variable  ${Empty}
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T8.3. Deleting snmp-server host
    Cli Run  master  snmp-server host 1.2.3.4 udp-port 12
    ${command}=  Set Variable  snmp-server host 4.3.2.1 udp-port 12
    ${diff}=  Set Variable  ${Empty}
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T8.4. Deleting snmp-server host
    ${command}=  Set Variable  snmp-server host
    ${diff}=  Create List  snmp-server host 4.3.2.1
    Run Keyword and Expect Error
    ...  *Error: Unexpected end of command*
    ...  Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T9.1. Deleting snmp-server location
	${command}=  Set Variable  snmp-server location \'44 DD\'
	${diff}=  Create List  snmp-server location \'44 DD\'
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T9.2. Deleting snmp-server location
    ${command}=  Set Variable  snmp-server location XXX
    ${diff}=  Create List  snmp-server location \'44 DD\'
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T9.3. Deleting snmp-server location
    ${command}=  Set Variable  snmp-server location
    ${diff}=  Create List  snmp-server location \'44 DD\'
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T10. Deleting tacacs server host
	${command}=  Set Variable  tacacs server host 1.1.1.1
	${diff}=  Create List  tacacs server host 1.1.1.1
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T11. Deleting tacacs server host
	${command}=  Set Variable  tacacs server host 1.2.3.4
	${diff}=  Create List  tacacs server host 1.2.3.4
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T12. Deleting tacacs server host
	${command}=  Set Variable  tacacs server host 2.2.2.2
	${diff}=  Create List  tacacs server host 2.2.2.2
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T13. Deleting tacacs server host
    ${command}=  Set Variable  tacacs server host 2.2.2.2 key 7 68010e0f162f3f
    ${diff}=  Create List
    ...  tacacs server host 2.2.2.2 timeout 20
    ...  tacacs server host 2.2.2.2 timeout 20 key 7 68010e0f162f3f
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T14. Deleting tacacs server key
	${command}=  Set Variable  tacacs server key 7 4244565147511f
	${diff}=  Create List  tacacs server key 7 4244565147511f
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T15. Deleting tacacs server timeout
	${command}=  Set Variable  tacacs server timeout 10
	${diff}=  Create List  tacacs server timeout 10
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T16. Deleting tacacs server host timeout
    ${command}=  Set Variable  tacacs server host 2.2.2.2 timeout 20
    ${diff}=  Create List
    ...  tacacs server host 2.2.2.2 key 7 68010e0f162f3f
    ...  tacacs server host 2.2.2.2 timeout 20 key 7 68010e0f162f3f
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T17.1. Deleting user
    Cli Run  master  user test
	${command}=  Set Variable  user test-user123
	${diff}=  Create List
	...  user test-user123
	...  hashed-password
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
T17.2. Deleting user
    Cli Run  master  user test
    ${command}=  Set Variable  user XXX
    ${diff}=  Set Variable  ${Empty}
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
T17.3. Deleting user
    Cli Run  master  user test
    ${command}=  Set Variable  user
    ${diff}=  Create List  user test
    Run Keyword and Expect Error
    ...  *Error: Unexpected end of command*
    ...  Delete single running config line and verify
    ...  ${command}
    ...  ${diff}

T18 Deleting lines
	[Tags]  skipped
	# Not Applicable any more

T19.1. Deleting virtual-ip
	${command}=  Set Variable  virtual-ip 4.4.4.4
	${diff}=  Create List  virtual-ip 4.4.4.4
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
	...  controller
T19.2. Deleting virtual-ip
    ${command}=  Set Variable  virtual-ip 11.11.11.11
    ${diff}=  Create List  virtual-ip 4.4.4.4
    Run Keyword and Expect Error
    ...  *Error: Invalid Use: Value specified, but doesn't match current value*
    ...  Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
    ...  controller
T19.3. Deleting virtual-ip
    ${command}=  Set Variable  virtual-ip
    ${diff}=  Create List  virtual-ip 4.4.4.4
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
    ...  controller

T20. Deleting switch
	${command}=  Set Variable  switch test
	${diff}=  Create List
	...  switch test
	...  fabric-role spine
	...  mac aa:bb:cc:dd:ee:ff
	...  interface ethernet1
	...  shutdown
	Delete single running config line and verify
	...  ${command}
	...  ${diff}

T21. Deleting switch fabric-role
	${command}=  Set Variable  fabric-role spine
	${diff}=  Create List
	...  fabric-role spine
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
	...  switch test

T22.1. Deleting switch mac
	${command}=  Set Variable  mac 11:22:33:44:55:66
	${diff}=  Create List
	...  mac aa:bb:cc:dd:ee:ff
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
	...  switch test
T22.2. Deleting switch mac
    ${command}=  Set Variable  mac 44:33:22:11:55:44
    ${diff}=  Create List
    ...  mac aa:bb:cc:dd:ee:ff
    Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
    ...  switch test
T22.3. Deleting switch mac
    ${command}=  Set Variable  mac
    ${diff}=  Create List
    ...  mac aa:bb:cc:dd:ee:ff
    Run Keyword and Expect Error
    ...  *Error: Unexpected end of command*
    ...  Delete single running config line and verify
    ...  ${command}
    ...  ${diff}
    ...  switch test

T23. Deleting switch interface
	${command}=  Set Variable  interface ethernet1
	${diff}=  Create List
	...  interface ethernet1
	...  shutdown
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
	...  switch test

T24. Deleting switch interface shutdown
	${command}=  Set Variable  shutdown
	${diff}=  Create List
	...  shutdown
	Delete single running config line and verify
	...  ${command}
	...  ${diff}
	...  switch test; interface ethernet1


*** Keywords ***
Generate Random Name
	[Arguments]  ${prefix}  ${suffix_len}
    ${regex}  Generate Random String  ${suffix_len}  [NUMBERS]
    ${name}  Catenate  SEPARATOR=  ${prefix}  ${regex}
    [Return]  ${name}

Suite Setup
	Base Suite Setup
	Config  master  no aaa accounting exec default start-stop local group tacacs+
	Config  master  no aaa authentication login default group tacacs+ local
	Cli Copy  running-config  snapshot://startup-config
	Cli Copy  running-config  snapshot://startup-config  node=slave
	Cli Copy  scp://bsn@regress:file-management-testsuite/extensive-config  snapshot://extensive-config
	Cli Copy  scp://bsn@regress:file-management-testsuite/extensive-file  file://extensive-file
	Cli Copy  scp://bsn@regress:file-management-testsuite/extensive-file  running-config
	Cli Copy  running-config  snapshot://test-config

Test Setup
	Base Test Setup


Test Teardown
	Bash Clear Known Hosts
	Cli Copy  snapshot://test-config  running-config
	Base Test Teardown

Suite Teardown
	Cli Copy  snapshot://startup-config  running-config
	Bash  master  curl -g -H "Cookie: session_cookie\=$FL_SESSION_COOKIE" localhost:8080/api/v1/data/controller/core/aaa/accounting -X DELETE -d '{"name": "local"}'
	Base Suite Teardown

Compare
	[Arguments]  ${first}  ${second}
	${status} =  Cli Compare  master  ${first}  ${second}
	${length} =  Get Length  ${status}
	Should Be Equal as Numbers  ${length}  0
	${status} =  Cli Compare  master  ${second}  ${first}
	${length} =  Get Length  ${status}
	Should Be Equal as Numbers  ${length}  0

Compare Negative
	[Arguments]  ${first}  ${second}
	${status} =  Cli Compare  master  ${first}  ${second}
	${length} =  Get Length  ${status}
	Should Not Be Equal as Numbers  ${length}  0
	${status} =  Cli Compare  master  ${second}  ${first}
	${length} =  Get Length  ${status}
	Should Not Be Equal as Numbers  ${length}  0

Compare and Expect Diff
	[Arguments]  ${first}  ${second}  ${diff}
	${status} =  Cli Compare  master  ${first}  ${second}
	${length} =  Get Length  ${status}
	${length_diff} =  Get Length  ${diff}
	Should Be Equal as Numbers  ${length}  ${length_diff}
	:For  ${idx}  In Range  ${length}
	\  ${str1}=  Get From List  ${status}  ${idx}
	\  ${str2}=  Get From List  ${diff}  ${idx}
	\  Should Contain  ${str1}  ${str2}

Delete single running config line and verify
	[Arguments]  ${command}  ${diff}  ${submode}=config
	Cli Copy  running-config  file://backup
	Cli Run  master  enable
	Cli Run  master  config
	Cli Run  master  ${submode}
	Cli Run  master  no ${command}
	Compare and Expect Diff  running-config  file://backup
	...  ${diff}
