*Settings
Documentation  SNMP Sanity Test Suite
Suite Setup  snmp suite setup
Suite Teardown   snmp suite teardown 
Test Setup   base test setup
Test Teardown   base test teardown
Force Tags   platform Sanity
Library  keywords/BsnCommon.py
Library  keywords/AppController.py
Library  keywords/BigTap.py
Library  keywords/SwitchLight.py

* Variable
${switchlight_version}  SwitchLight 2.0.0
${oneGlb9_name}  ethernet48
${tenGlb9_name}  ethernet51
${tenGly2_name}  ethernet48
${fortyGly2_name}  ethernet52

*Test Case
Configure and Verify Configuration via CLI on LB9 and LY2  
    verify config

Verify SNMP OID sysContact on LB9 and LY2  
    verify snmp attribute  s1  sysContact.0  nw_admin@super_awesome_company.com
    verify snmp attribute  s2  sysContact.0  nw_admin@super_awesome_company.com

Verify SNMP OID sysLocation on LB9 and LY2  
    verify snmp attribute  s1  sysLocation.0  CS_RACK11_6020
    verify snmp attribute  s2  sysLocation.0  CS_RACK11_6015

Verify SNMP OID sysDescr on LB9 and LY2  
    verify snmp attribute  s1  sysDescr.0  ${switchlight_version}
    verify snmp attribute  s2  sysDescr.0  ${switchlight_version}

Verify SNMP OID ifDescr of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifDescr.3  ma1
    verify snmp attribute  s2  ifDescr.3  ma1
 
Verify SNMP OID ifType of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifType.3  ethernetCsmacd
    verify snmp attribute  s2  ifType.3  ethernetCsmacd
    
Verify SNMP OID ifAdminStatus of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifAdminStatus.3  up
    verify snmp attribute  s2  ifAdminStatus.3  up
    
Verify SNMP OID ifOperStatus of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifOperStatus.3  up
    verify snmp attribute  s2  ifOperStatus.3  up
    
Verify SNMP OID ifSpeed of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifSpeed.3  1000000000
    verify snmp attribute  s2  ifSpeed.3  1000000000

Verify SNMP OID ifMtu of ma1 on LB9 and LY2  
    verify snmp attribute  s1  ifMtu.3  1500
    verify snmp attribute  s2  ifMtu.3  1500


Verify SNMP OID ifDescr of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifDescr.1048  ${oneGlb9_name}
    
Verify SNMP OID ifType of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifType.1048  ethernetCsmacd
    
Verify SNMP OID ifAdminStatus of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifAdminStatus.1048  up
    
Verify SNMP OID ifOperStatus of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifOperStatus.1048  up
    
Verify SNMP OID ifSpeed of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifSpeed.1048  1000000000
    
Verify SNMP OID ifHighSpeed of 1Gig Data Port (LB9) 
    verify snmp attribute  s1  ifHighSpeed.1048  1000
    
Verify SNMP OID ifPhysAddress of 1Gig Data Port (LB9)
    ${mac_address1}=  cli show interface macaddress  s1  ${oneGlb9_name} 
    verify snmp attribute  s1  ifPhysAddress.1048  ${mac_address1}
    
Verify SNMP OID ifDescr of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifDescr.1051  ${tenGlb9_name}
    
Verify SNMP OID ifType of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifType.1051  ethernetCsmacd
    
Verify SNMP OID ifAdminStatus of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifAdminStatus.1051  up
    
Verify SNMP OID ifOperStatus of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifOperStatus.1051  up
    
Verify SNMP OID ifSpeed of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifSpeed.1051  4294967295
    
Verify SNMP OID ifHighSpeed of 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifHighSpeed.1051  10000

Verify SNMP OID ifPhysAddress of 10Gig Data Port (LB9) 
    ${mac_address1}=  cli show interface macaddress  s1  ${tenGlb9_name} 
    verify snmp attribute  s1  ifPhysAddress.1051  ${mac_address1}

Verify SNMP OID ifDescr of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifDescr.1048  ${tenGly2_name}
    
Verify SNMP OID ifType of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifType.1048  ethernetCsmacd
    
Verify SNMP OID ifAdminStatus of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifAdminStatus.1048  up
    
Verify SNMP OID ifOperStatus of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifOperStatus.1048  up
    
Verify SNMP OID ifSpeed of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifSpeed.1048  4294967295
    
Verify SNMP OID ifHighSpeed of 10Gig Data Port (LY2) 
    verify snmp attribute  s2  ifHighSpeed.1048  10000

Verify SNMP OID ifPhysAddress of 10Gig Data Port (LY2) 
    ${mac_address1}=  cli show interface macaddress  s2  ${tenGly2_name} 
    verify snmp attribute  s2  ifPhysAddress.1051  ${mac_address1}

Verify SNMP OID ifDescr of 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifDescr.1052  ${fortyGly2_name}
    
Verify SNMP OID ifType of 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifType.1052  ethernetCsmacd  
    
Verify SNMP OID ifAdminStatus of 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifAdminStatus.1052  up
    
Verify SNMP OID ifOperStatus 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifOperStatus.1052  up
    
Verify SNMP OID ifSpeed of 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifSpeed.1052  4294967295
    
Verify SNMP OID ifHighSpeed of 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifHighSpeed.1052  40000
    
Verify SNMP OID ifPhysAddress of 40Gig Data Port (LY2) 
    ${mac_address1}=  cli show interface macaddress  s2  ${fortyGly2_name} 
    verify snmp attribute  s2  ifPhysAddress.1052  ${mac_address1}

Verify SNMP OID ifDescr of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifDescr.1061  port-channel1

Verify SNMP OID ifType of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifType.1061  ethernetCsmacd
    
Verify SNMP OID ifAdminStatus of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifAdminStatus.1061  up
    
Verify SNMP OID ifOperStatus of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifOperStatus.1061  up
    
Verify SNMP OID ifSpeed of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifSpeed.1061  4294967295
    
Verify SNMP OID ifHighSpeed of PortChannel across 10Gig Data Port (LB9) 
    verify snmp attribute  s1  ifHighSpeed.1061  20000

Verify SNMP OID ifPhysAddress of PortChannel across 10Gig Data Port (LB9) 
    ${mac_address1}=  cli show interface macaddress  s1  port-channel1 
    verify snmp attribute  s1  ifPhysAddress.1061  ${mac_address1}
    
Verify SNMP OID ifDescr of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifDescr.1090  port-channel30

Verify SNMP OID ifType of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifType.1090  ethernetCsmacd

Verify SNMP OID ifAdminStatus of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifAdminStatus.1090  up

Verify SNMP OID ifOperStatus of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifOperStatus.1090  up

Verify SNMP OID ifSpeed of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifSpeed.1090  4294967295

Verify SNMP OID ifHighSpeed of PortChannel across 40Gig Data Port (LY2) 
    verify snmp attribute  s2  ifHighSpeed.1090  80000

Verify SNMP OID ifPhysAddress of PortChannel across 40Gig Data Port (LY2) 
    ${mac_address1}=  cli show interface macaddress  s2  port-channel30 
    verify snmp attribute  s2  ifPhysAddress.1090  ${mac_address1}

Verify snmpgetnext works as expected 
    verify snmpgetnext
    
Verify snmpbulkget works as expected 
    verify snmpbulkget
    
Verify snmpbulkwalk works as expected 
    verify snmpbulkwalk
    
Modify SNMP Community and Verify SNMP OID sysContact 
    modify community
    
Verify no snmp-server disables snmp 
    disable snmp
    
Restart process SNMPD and verify SNMP Stats 
    restart snmpd

* Keywords  
snmp suite setup
    base suite setup        
    cli add snmp keyword   s1   community   ro public       
    cli add snmp keyword   s1   location   CS_RACK11_6020       
    cli add snmp keyword   s1   contact   nw_admin@super_awesome_company.com       
    cli add snmp host   s1   10.192.66.230   traps   public   161   
    cli add snmp host   s1   10.192.66.230   informs   public   161
    cli add portchannel  s1  1  49-50  L3  
    cli enable snmp   s1              
    cli add snmp keyword   s2   community   ro public       
    cli add snmp keyword   s2   location   CS_RACK11_6015       
    cli add snmp keyword   s2   contact   nw_admin@super_awesome_company.com       
    cli add snmp host   s2   10.192.66.230   traps   public   161   
    cli add snmp host   s2   10.192.66.230   informs   public   161  
    cli add portchannel  s2  7  43,44  L3
    cli add portchannel  s2  30  49,52  L3
    cli add portchannel  s3  30  49,52  L3  
    cli enable snmp   s2             
    Sleep   30             

verify config               
    ${snmp_output}=  cli show snmp   s1        
    Should Contain   ${snmp_output}   CS_RACK11_6020        `                                           
    Should Contain   ${snmp_output}   nw_admin@super_awesome_company.com        
    Should Contain   ${snmp_output}   public        
    Should Contain   ${snmp_output}   enabled  
    cli verify portchannel  s1  1       
    ${snmp_output}=  cli show snmp  s2        
    Should Contain   ${snmp_output}   CS_RACK11_6015        
    Should Contain   ${snmp_output}   nw_admin@super_awesome_company.com        
    Should Contain   ${snmp_output}   public        
    Should Contain   ${snmp_output}   enabled  
    cli verify portchannel  s2  7

verify snmp attribute  [Arguments]  ${switch}  ${attribute}  ${expected_value}               
    ${snmp_key} =     snmp cmd   ${switch}   snmpget    public   ${attribute}  
    Should Contain   ${snmp_key}   ${expected_value}

verify snmpgetnext
    ${snmp_key} =   snmp cmd  s1  snmpgetnext  public  ifDescr.2
    Should Contain  ${snmp_key}  ma1

verify snmpbulkget
    ${snmp_key}=  snmp cmd opt   s1  snmpbulkget  -Cr1  public  ifDescr.2
    Should Contain  ${snmp_key}  ma1

verify snmpbulkwalk
    ${snmp_key}=  snmp cmd opt   s1  snmpbulkwalk  -Cr2  public  ifDescr.3
    Should Contain  ${snmp_key}  ma1

modify community
    cli delete snmp keyword  s1  community  ro public
    cli add snmp keyword  s1  community  ro bigswitch
    ${snmp_key}=  snmp cmd  s1  snmpget   bigswitch  sysContact.0
    Should Contain  ${snmp_key}  nw_admin@super_awesome_company.com
    cli delete snmp keyword  s1  community  ro bigswitch
    cli add snmp keyword  s1  community  ro public

disable snmp
    cli disable switch snmp  s1
    Sleep  5
    ${snmp_output} =   cli show snmp  s1
    Should Contain  ${snmp_output}  disabled
    ${snmp_key}=  snmp cmd  s1  snmpget   public  sysContact.0
    Should Be Empty  ${snmp_key}  
    cli enable snmp  s1
    Sleep  5
    ${snmp_output} =   cli show snmp  s1
    Should Contain  ${snmp_output}  enabled
    ${snmp_key}=  snmp cmd  s1  snmpget   public  sysContact.0
    Should Contain  ${snmp_key}  nw_admin@super_awesome_company.com

restart snmpd
    bash restart process  s1   snmpd
    ${snmp_output}=  cli show snmp  s1
    Should Contain  ${snmp_output}  CS_RACK11_6020
    Should Contain  ${snmp_output}  nw_admin@super_awesome_company.com
    Should Contain  ${snmp_output}  public
    ${snmp_key}=  snmp cmd  s1  snmpget  public  sysContact.0
    Should Contain  ${snmp_key}  nw_admin@super_awesome_company.com 

snmp suite teardown  
    cli disable switch snmp   s1            
    cli delete snmp keyword   s1   community   ro public       
    cli delete snmp keyword   s1   location   CS_RACK11_6020       
    cli delete snmp keyword   s1   contact   nw_admin@super_awesome_company.com       
    cli delete snmp host   s1   10.192.66.230   traps   public   161   
    cli delete snmp host   s1   10.192.66.230   informs   public   161       
    cli disable switch snmp   s2         
    cli delete snmp keyword   s2   community   ro public       
    cli delete snmp keyword   s2   location   CS_RACK11_6015       
    cli delete snmp keyword   s2   contact   nw_admin@super_awesome_company.com       
    cli delete snmp host   s2   10.192.66.230   traps   public   161   
    cli delete snmp host   s2   10.192.66.230   informs   public   161
    cli delete portchannel  s1  1
    cli delete portchannel  s2  7
    cli delete portchannel  s2  30
    cli delete portchannel  s3  30
    base suite teardown      