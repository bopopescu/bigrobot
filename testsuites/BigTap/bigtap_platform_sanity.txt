*Settings
Documentation  BigTap Platform Sanity Test Suite
Suite Setup  sanity suite setup
Suite Teardown   sanity suite teardown
#Test Setup   base test setup
#Test Teardown  base test teardown 
Force Tags   bigtap  platform  sanity
Library  keywords/BsnCommon.py
Library  keywords/AppController.py
Library  keywords/BigTap.py
Library  keywords/SwitchLight.py
Library  keywords/Ixia.py
Library  Collections.py

* Variable
${scaling_limit_1G}            2044
${scaling_limit_10G}           1020
${switch_name_1}              AC1G-ACCTON
${switch_name_2}              AC10G-ACCTON
${switch_name_3}              AC1G-QUANTA
${switch_name_4}              AC10G-QUANTA

${filter_ac1g_1}               ethernet1
${filter_ac1g_nick_1}          AC1G-F1
${delivery_ac1g_1}             ethernet2
${delivery_ac1g_nick_1}        AC1G-D1

${filter_ac10g_1}              ethernet45
${filter_ac10g_nick_1}         AC10G-F1
${delivery_ac10g_1}            ethernet46
${delivery_ac10g_nick_1}       AC10G-D1

${filter_q1g_1}                ethernet1
${filter_q1g_nick_1}           Q1G-F1
${delivery_q1g_1}              ethernet2
${delivery_q1g_nick_1}         Q1G-D1

${filter_q10g_1}               ethernet1
${filter_q10g_nick_1}          Q10G-F1
${delivery_q10g_1}             ethernet2
${delivery_q10g_nick_1}        Q10G-D1

${policy_name_1}              AC1G-POLICY
${policy_name_2}              AC10G-POLICY
${policy_name_3}              Q1G-POLICY
${policy_name_4}              Q10G-POLICY

${vlan_rewrite_1}   1001
${vlan_rewrite_2}   1002
${vlan_rewrite_3}   1003
${vlan_rewrite_4}   1004
*Test Case
verify configuration is successful
    verify config

* Keyword
sanity suite setup
    base suite setup
    rest add switch alias  s1  ${switch_name_1}
    rest add switch alias  s2  ${switch_name_2}
    rest add switch alias  s3  ${switch_name_3}
    rest add switch alias  s4  ${switch_name_4}
    rest add interface role  s1  ${filter_ac1g_1}  filter  ${filter_ac1g_nick_1}  rewrite_vlan=${vlan_rewrite_1}
    rest add interface role  s2  ${filter_ac10g_1}  filter  ${filter_ac10g_nick_1}  rewrite_vlan=${vlan_rewrite_2}
    rest add interface role  s3  ${filter_q1g_1}  filter  ${filter_q1g_nick_1}  rewrite_vlan=${vlan_rewrite_3}
    rest add interface role  s4  ${filter_q10g_1}  filter  ${filter_q10g_nick_1}  rewrite_vlan=${vlan_rewrite_4}                
    rest add interface role  s1  ${delivery_ac1g_1}  delivery  ${delivery_ac1g_nick_1}
    rest add interface role  s2  ${delivery_ac10g_1}  delivery  ${delivery_ac10g_1}              
    rest add interface role  s3  ${delivery_q1g_1}  delivery  ${delivery_q1g_nick_1}
    rest add interface role  s4  ${delivery_q10g_1}  delivery  ${delivery_q10g_nick_1}
    Sleep  2
    setup bigtap policy  ${policy_name_1}  ${filter_ac1g_nick_1}   ${delivery_ac1g_nick_1}   forward    
    setup bigtap policy  ${policy_name_2}  ${filter_ac10g_nick_1}  ${delivery_ac10g_nick_1}  forward    
    setup bigtap policy  ${policy_name_3}  ${filter_q1g_nick_1}    ${delivery_q1g_nick_1}    forward    
    setup bigtap policy  ${policy_name_4}  ${filter_q10g_nick_1}   ${delivery_q10g_nick_1}   forward    
    Sleep  30 

verify config
    ${verify_policy1}=  rest verify bigtap policy  ${policy_name_1}  num_filter_intf=1  num_delivery_intf=1
    Should be true  ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${policy_name_3}  num_filter_intf=1  num_delivery_intf=1
    Should be true  ${verify_policy2}
    ${verify_policy3}=  rest verify bigtap policy  ${policy_name_3}  num_filter_intf=1  num_delivery_intf=1
    Should be true  ${verify_policy3}
    ${verify_policy4}=  rest verify bigtap policy  ${policy_name_4}  num_filter_intf=1  num_delivery_intf=1
    Should be true  ${verify_policy4}    

setup bigtap policy     [Arguments]  ${policy_name}  ${filter_nick}  ${delivery_nick}  ${action}
    rest add policy  admin-view  ${policy_name}  ${action}
    rest add policy match  admin-view  ${policy_name}  1  {"any-traffic": true, "sequence": 1}
    rest add policy interface  admin-view  ${policy_name}  ${filter_nick}  filter
    rest add policy interface  admin-view  ${policy_name}  ${delivery_nick}  delivery 
    Sleep  2

delete bigtap configuration
    rest delete policy  admin-view  ${policy_name_1}
    rest delete policy  admin-view  ${policy_name_2}
    rest delete policy  admin-view  ${policy_name_3}
    rest delete policy  admin-view  ${policy_name_4}         
    rest delete interface role  s1  ${filter_ac1g_1}    filter          
    rest delete interface role  s2  ${filter_ac10g_1}    filter
    rest delete interface role  s3  ${filter_q1g_1}    filter          
    rest delete interface role  s4  ${filter_q10g_1}    filter
    rest delete interface role  s1  ${delivery_ac1g_1}    delivery          
    rest delete interface role  s2  ${delivery_ac10g_1}    delivery
    rest delete interface role  s3  ${delivery_q1g_1}    delivery          
    rest delete interface role  s4  ${delivery_q10g_1}    delivery
    rest delete interface  s1  ${filter_ac1g_1}             
    rest delete interface  s2  ${filter_ac10g_1}    
    rest delete interface  s3  ${filter_q1g_1}              
    rest delete interface  s4  ${filter_q10g_1}    
    rest delete interface  s1  ${delivery_ac1g_1}              
    rest delete interface  s2  ${delivery_ac10g_1}    
    rest delete interface  s3  ${delivery_q1g_1}       
    rest delete interface  s4  ${delivery_q10g_1}    
    Sleep  30

sanity suite teardown
    delete bigtap configuration
    rest delete switch alias  s1
    rest delete switch alias  s2
    rest delete switch alias  s3
    rest delete switch alias  s4
    rest delete switch  s1
    rest delete switch  s2
    rest delete switch  s3
    rest delete switch  s4                           
    base suite teardown        
