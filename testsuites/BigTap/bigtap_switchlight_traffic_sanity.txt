*Settings
Documentation  BigTap SwitchLight Traffic Test Suite
Suite Setup  bigtap suite setup
Suite Teardown   bigtap suite teardown
Test Setup   base test setup
Test Teardown  base test teardown 
Force Tags   platform Sanity
Library  keywords/BsnCommon.py
Library  keywords/AppController.py
Library  keywords/BigTap.py
Library  keywords/SwitchLight.py
Library  keywords/Ixia.py

* Variable
${switch_1_alias}  LB7
${switchlight_version}  SwitchLight 2.0.0
${netmask}  18
${gateway}  10.192.64.1
${dns_server}  10.192.3.1
${dns_domain}  bigswitch.com
${filter_1}  ethernet1  
${filter_nick}  F1
${delivery_1}  ethernet2  
${delivery_nick}  D1
  


*Test Case

Verify L2 traffic: frame size 64 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 traffic: frame size 128 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=128  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 traffic: frame size 256 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=256  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity
    
Verify L2 traffic: frame size 512 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=512  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity
    
Verify L2 traffic: frame size 1024 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=1024  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity
    
Verify L2 traffic: frame size 1518 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=1518  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity
    
Verify L2 traffic: frame size 9216 bytes
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=9216  frame_cnt=50000  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: VLAN Tagged Traffic
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=8100  vlan_id=2048  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: Spanning Tree Protocol (for bridges) IEEE 802.1D
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=0802  src_mac=00:11:12:13:14:01  dst_mac=01:80:c2:00:00:00  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: Spanning Tree Protocol (for provider bridges) IEEE 802.1AD
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=0802  src_mac=00:11:12:13:14:01  dst_mac=01:80:c2:00:00:08  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: Ethernet flow control (Pause frame) IEEE 802.3x
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=0800  src_mac=00:11:12:13:14:01  dst_mac=01:80:c2:00:00:01  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: LLDP with ethernet ethertype
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=0800  src_mac=00:11:12:13:14:01  dst_mac=01:80:c2:00:00:0E  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity

Verify L2 Traffic: Ethernet OAM Protocol IEEE 802.3ah/Slow Protocols
    IXIA initialize  tg1
    ${stream}=  IXIA L2 add  flow=a->b  frame_rate=10000  frame_size=64  frame_cnt=50000  ethertype=8809  src_mac=00:11:12:13:14:01  dst_mac=01:80:c2:00:00:02  name=a_b_flow
    IXIA start L2 traffic  ${stream}
    sleep  10
    IXIA stop L2 traffic  ${stream}
    verify results
    [Tags]  traffic  sanity   
    
        
        
* Keywords

bigtap suite setup
    rest add switch alias  s1  LB7
    rest add interface role  ${filter_1}  filter  ${filter_nick}  switch_alias=${switch_1_alias}  
    rest add interface role  ${delivery_1}  delivery  ${delivery_nick}  switch_alias=${switch_1_alias}
    rest add policy  admin-view  P1  forward
    rest add policy match  admin-view  P1  1  {"any-traffic": true, "sequence": 1}
    rest add policy interface  admin-view  P1  F1  filter
    rest add policy interface  admin-view  P1  D1  delivery    
        
verify results
    Sleep  5
    ${report}=  IXIA fetch port stats
    ${tx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${rx_value}=  verify dict key  ${report}  b  received_frames
    Should be equal  ${tx_value}  ${rx_value}

bigtap suite teardown
    rest delete policy  admin-view  P1
    rest delete interface role  ${filter_1}  filter  ${filter_nick}  switch_alias=${switch_1_alias}  
    rest delete interface role  ${delivery_1}  delivery  ${delivery_nick}  switch_alias=${switch_1_alias}
    rest delete interface  ${filter_1}  switch_alias=${switch_1_alias}
    rest delete interface  ${delivery_1}  switch_alias=${switch_1_alias}
    rest delete switch alias  s1
    rest delete switch  s1