*Settings
Documentation  BigTap SNMP Test Suite Release:Blackbird Feature:SNMP
Suite Setup  snmp suite setup
Suite Teardown   snmp suite teardown
Test Setup   base test setup
Test Teardown   base test teardown
Force Tags   BigTap SNMP

Library  keywords/AppController.py
Library  keywords/BsnCommon.py

* Variable
${version_string}	Big Tap Controller 3.0.0	
    
* Test Case
Configure and Verify Configuration  
    verify config
    [Tags]  bigtap  snmp  

Verify SNMP OID sysContact  
    ${snmp_key}=  snmp get  master  public  sysContact.0
    Should Contain  ${snmp_key}  Big Switch Networks
    [Tags]  bigtap  snmp  

Verify SNMP OID sysLocation  
    ${snmp_key}=  snmp get  master  public  sysLocation.0
    Should Contain  ${snmp_key}  Mountain View
    [Tags]  bigtap  snmp  

Verify SNMP OID sysDescr  
    ${snmp_key}=  snmp get  master  public  sysDescr.0
    Should Contain  ${snmp_key}     ${version_string} 
    [Tags]  bigtap  snmp  

Verify SNMP OID ifDescr  
    ${snmp_key}=  snmp get  master  public  ifDescr.2
    Should Contain  ${snmp_key}  eth0
    [Tags]  bigtap  snmp  

Verify SNMP OID ifType  
    ${snmp_key}=  snmp get  master  public  ifType.2
    Should Contain  ${snmp_key}  ethernetCsmacd
    [Tags]  bigtap  snmp  
    
Verify SNMP OID ifOperStatus  
    ${snmp_key}=  snmp get  master  public  ifOperStatus.2
    Should Contain  ${snmp_key}  up
    [Tags]  bigtap  snmp  
    
Verify SNMP OID ifAdminStatus  
    ${snmp_key}=  snmp get  master  public  ifAdminStatus.2
    Should Contain  ${snmp_key}  up     
    [Tags]  bigtap  snmp  

Verify snmpgetnext works as expected
    ${snmp_key}=  snmp getnext    master  public  ifDescr.1
    Should Contain  ${snmp_key}  eth0
    [Tags]  bigtap  snmp  

verify snmpbulkget works as expected
    ${snmp_key}=  snmp cmd opt  master  snmpbulkget  -Cn1 -Cr3 -Os   public  ifDescr.1 
    Should Contain  ${snmp_key}  eth0
    [Tags]  bigtap  snmp  

verify snmpbulkwalk works as expected
    ${snmp_key}=  snmp cmd opt  master  snmpbulkwalk  -Cn1 -Cr3 -Os   public  ifDescr.2 
    Should Contain  ${snmp_key}  eth0
    [Tags]  bigtap  snmp  
 
Restart process SNMP and verify
    restart process on controller  snmpd  Slave
    Sleep  10    
    ${snmp_key}=  snmp get  master  public  sysDescr.0
    Should Contain  ${snmp_key}  ${version_string} 
    [Tags]  bigtap  snmp  

Change community from public to bigswitch and verify snmp walk
    rest add snmp keyword  community  bigswitch
    ${snmp_key}=  snmp get  master  bigswitch  sysDescr.0
    Should Contain  ${snmp_key}  ${version_string}   
    [Tags]  bigtap  snmp  

       
* Keywords
snmp suite setup
    rest add snmp keyword  community  public
    rest add snmp keyword  contact  Big Switch Networks
    rest add snmp keyword  location  Mountain View
    rest add snmp keyword  trap-enable  True
    rest add snmp host  10.192.3.22  162    
    rest add snmp host  10.192.66.230  162    
    rest add firewall rule snmp  udp  162
    Sleep  10        

verify config
    ${snmp_output}=  rest show snmp
    ${snmp_key}=  verify json key  ${snmp_output}  0  community  
    Should Be Equal As Strings  ${snmp_key}  public
    ${snmp_key}=  verify json key  ${snmp_output}  0  contact  
    Should Be Equal As Strings  ${snmp_key}  Big Switch Networks        
    ${snmp_key}=  verify json key  ${snmp_output}  0  location  
    Should Be Equal As Strings  ${snmp_key}  Mountain View
    ${snmp_key}=  verify json key  ${snmp_output}  0  trap-enable  
    Should Be True  ${snmp_key}
    ${snmp_output}=  rest show snmp host
    ${snmp_key}=  verify json key  ${snmp_output}  0  host  
    Should Be Equal As Strings  ${snmp_key}  10.192.3.22
    ${snmp_key}=  verify json key  ${snmp_output}  0  udp-port  
    Should Be Equal As Integers  ${snmp_key}  162
    ${snmp_key}=  verify json key  ${snmp_output}  1  host  
    Should Be Equal As Strings  ${snmp_key}  10.192.66.230
    ${snmp_key}=  verify json key  ${snmp_output}  1  udp-port  
    Should Be Equal As Integers  ${snmp_key}  162
           
snmp suite teardown
    rest add snmp keyword  community  null
    rest add snmp keyword  contact  null
    rest add snmp keyword  location  null
    rest add snmp keyword  trap-enable  false
    rest delete snmp host  10.192.66.230  161 
    rest delete firewall rule snmp  udp  161     
    base suite teardown
    
    
