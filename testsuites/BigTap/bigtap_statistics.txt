*Settings
Documentation                           BigTap Statistics Test Suite
Suite Setup                             statistics suite setup
Suite Teardown                          statistics suite teardown
Test Setup                              statistics test setup
Test Teardown                           statistics test teardown 
Force Tags                              BigTap  blackbird-300  Accton-AS6700  Accton-AS5710  Accton-AS4600  Accton-AS5610  statistics
Library                                 keywords/BsnCommon.py
Library                                 keywords/AppController.py
Library                                 keywords/BigTap.py
Library                                 keywords/SwitchLight.py
Library                                 keywords/Ixia.py
Library                                 Collections.py
Library                                 OperatingSystem.py
Library                                 String.py

* Variables
#### Switch 1: app-ras4600-1
${sw1_alias}                            app-ras4600-1
${sw1_tgfilter_intf_1}                  ethernet1
${sw1_tgfilter_alias_1}                 ixia-2-1
${sw1_tgfilter_intf_2}                  ethernet2
${sw1_tgfilter_alias_2}                 ixia-2-2
${sw1_tgdelivery_intf_1}                ethernet2
${sw1_tgdelivery_alias_1}               ixia-2-2

${sw1sw2_core_pc_range}                 49-52
${sw1sw2_core_pc_number}                1
${sw1sw2_core_pc_name}                  port-channel1
${sw1sw2_core_pc_member1}               ethernet49
${sw1sw2_core_pc_member2}               ethernet50
${sw1sw2_core_pc_member3}               ethernet51
${sw1sw2_core_pc_member4}               ethernet52

${sw1_pre_service_interface}            ethernet13
${sw1_pre_service_name}                 s1-pre-service
${sw1_post_service_interface}           ethernet14
${sw1_post_service_name}                s1-post-service
${sw1_service_name}                     s1-service

#### Switch 2: app-ras5710-1
${sw2_alias}                            app-ras5710-1
${sw2_tgfilter_intf_1}                  ethernet1
${sw2_tgfilter_alias_1}                 ixia-1-5
${sw2_tgdelivery_intf_1}                ethernet2
${sw2_tgdelivery_alias_1}               ixia-1-6
${sw2_tgdelivery_intf_2}                ethernet1
${sw2_tgdelivery_alias_2}               ixia-1-5

${sw2sw1_core_pc_range}                 45-48
${sw2sw1_core_pc_number}                1
${sw2sw1_core_pc_name}                  port-channel1
${sw2sw1_core_pc_member1}               ethernet45
${sw2sw1_core_pc_member2}               ethernet46
${sw2sw1_core_pc_member3}               ethernet47
${sw2sw1_core_pc_member4}               ethernet48

${sw2sw3_core_pc_range}                 49-50
${sw2sw3_core_pc_number}                2
${sw2sw3_core_pc_name}                  port-channel2
${sw2sw3_core_pc_member1}               ethernet49
${sw2sw3_core_pc_member2}               ethernet50


#### Switch 3: app-ras6700-1
${sw3_alias}                            app-ras6700-1
${sw3sw2_core_pc_range}                 29-30
${sw3sw2_core_pc_number}                2
${sw3sw2_core_pc_name}                  port-channel2
${sw3sw2_core_pc_member1}               ethernet29
${sw3sw2_core_pc_member2}               ethernet30

${sw3sw4_core_pc_range}                 31-32
${sw3sw4_core_pc_number}                3
${sw3sw4_core_pc_name}                  port-channel3
${sw3sw4_core_pc_member1}               ethernet31
${sw3sw4_core_pc_member2}               ethernet32

${sw3_pre_service_interface}            ethernet13
${sw3_pre_service_name}                 s3-pre-service
${sw3_post_service_interface}           ethernet14
${sw3_post_service_name}                s3-post-service
${sw3_service_name}                     s3-service

#### Switch 4: app-ras5610-1
${sw4_alias}                            app-ras5610-1
${sw4_tgfilter_intf_1}                  ethernet1
${sw4_tgfilter_alias_1}                 ixia-1-1
${sw4_tgdelivery_intf_1}                ethernet2
${sw4_tgdelivery_alias_1}               ixia-1-2

${sw4sw3_core_pc_range}                 49-50
${sw4sw3_core_pc_number}                3
${sw4sw3_core_pc_name}                  port-channel3
${sw4sw3_core_pc_member1}               ethernet49
${sw4sw3_core_pc_member2}               ethernet50

${sw4sw5_core_pc_range}                 7-10
${sw4sw5_core_pc_number}                4
${sw4sw5_core_pc_name}                  port-channel4
${sw4sw5_core_pc_member1}               ethernet7
${sw4sw5_core_pc_member2}               ethernet8
${sw4sw5_core_pc_member3}               ethernet9
${sw4sw5_core_pc_member4}               ethernet10

#### Switch 5: app-ras4600-2
${sw5_alias}                            app-ras4600-2
${sw5_tgfilter_intf_1}                  ethernet1
${sw5_tgfilter_alias_1}                 ixia-2-5
${sw5_tgdelivery_intf_1}                ethernet2
${sw5_tgdelivery_alias_1}               ixia-2-6
${sw5_tgdelivery_intf_2}                ethernet1
${sw5_tgdelivery_alias_2}               ixia-2-5

${sw5sw4_core_pc_range}                 49-52
${sw5sw4_core_pc_number}                4
${sw5sw4_core_pc_name}                  port-channel4
${sw5sw4_core_pc_member1}               ethernet49
${sw5sw4_core_pc_member2}               ethernet50
${sw5sw4_core_pc_member3}               ethernet51
${sw5sw4_core_pc_member4}               ethernet52

${sw5_pre_service_interface}            ethernet13
${sw5_pre_service_name}                 s5-pre-service
${sw5_post_service_interface}           ethernet14
${sw5_post_service_name}                s5-post-service
${sw5_service_name}                     s5-service


### Common
${statistics_policy_1}                  policy-stats-1
${statistics_policy_2}                  policy-stats-2
${policy_name_1}                        P1
${policy_name_2}                        ZP1
${policy_name_overlap}                  _ZP1_o_P1

* Test Case
TC001: Verify policy interface statistics on controller, when filter and delivery interface are on same switch
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->b  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_b_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${tx_value}=  verify dict key  ${report}  b  received_valid_frames
    ${rx_policy_value}=  rest return policy stats  ${statistics_policy_1}  filter     ${sw1_tgfilter_alias_1}     packet-count    
    ${tx_policy_value}=  rest return policy stats  ${statistics_policy_1}  delivery   ${sw1_tgdelivery_alias_1}   packet-count            
    ${in_range}=  ixia verify traffic rate  ${rx_policy_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_policy_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC002: Verify switch interface statistics when filter and delivery interface are on same switch
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->b  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_b_flow
    clear stats
    cli clear interface statistics  s1
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${tx_value}=  verify dict key  ${report}  b  received_valid_frames
    ${rx_switch_value}=  cli return interface counter brief     s1      ${sw1_tgfilter_intf_1}      rx
    ${tx_switch_value}=  cli return interface counter brief     s1      ${sw1_tgdelivery_intf_1}    tx        
    ${in_range}=  ixia verify traffic rate  ${rx_switch_value}  ${rx_value}     rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}  ${tx_value}     rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC003: Verify policy interface statistics on controller, when filter and delivery interface are on different switches 
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5    
    ${s1_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s2s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s2s3_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s3s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s3s2_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s3s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s3s4_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s4s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s4s3_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s4s5_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s4s5_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s5s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s5s4_core_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s5_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=delivery   interface_name=${sw5_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s5_policy_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC004: Verify policy interface statistics across fabric, when multiple policies traverse the core. 
    change interface role to  filter    ${sw1_tgfilter_intf_2}      ${sw1_tgfilter_alias_2}         s1
    change interface role to  delivery  ${sw5_tgdelivery_intf_2}    ${sw5_tgdelivery_alias_2}       s5
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_2}  1                          {"ether-type": 2048, "dst-tp-port": 8080, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw1_tgfilter_alias_2}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw5_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${statistics_policy_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_h_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    ${stream2}=  L3 add  flow=b->g  frame_rate=20000  frame_cnt=200000  frame_size=1518  name=b_g_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=8080
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10    
    start traffic
    sleep  10
    stop traffic
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5        
    ${report}=  fetch port stats
    ${rx_value_1}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0
        
    ${rx_value_2}=  verify dict key  ${report}  b  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0
                      
    ${tx_value_1}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0
    
    ${tx_value_2}=  verify dict key  ${report}  g  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0
    
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_1}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_1}  100000         rangev=20
    Should be true  ${in_range}    
    ${in_range}=  ixia verify traffic rate  ${rx_value_2}  ${tx_value_2}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_2}  200000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_2}  200000         rangev=20
    Should be true  ${in_range}    
    
    ### First check filter interface on switch 1 for both policies
    ${s1_policy_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s1_policy_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=filter     interface_name=${sw1_tgfilter_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check tx core interface on switch 1 for both policies     
    ${s1s2_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s1s2_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check rx core interface on switch 2 for both policies     
    ${s2s1_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s2s1_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check tx core interface on switch 2 for both policies     
    ${s2s3_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s2s3_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s2s3_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s2s3_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check rx core interface on switch 3 for both policies     
    ${s3s2_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s3s2_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s3s2_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s3s2_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check tx core interface on switch 3 for both policies     
    ${s3s4_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s3s4_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s3s4_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s3s4_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check rx core interface on switch 4 for both policies     
    ${s4s3_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s4s3_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s4s3_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s4s3_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check tx core interface on switch 4 for both policies     
    ${s4s5_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s4s5_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s4s5_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s4s5_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Next check rx core interface on switch 5 for both policies     
    ${s5s4_core_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s5s4_core_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s5s4_core_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s5s4_core_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ### Finally check tx on delivery interfaces on switch 5 for both policies     
    ${s5_policy_value_1}=    rest return policy stats  ${statistics_policy_1}   interface_type=delivery   interface_name=${sw5_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s5_policy_value_1}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}
    ${s5_policy_value_2}=    rest return policy stats  ${statistics_policy_2}   interface_type=delivery   interface_name=${sw5_tgdelivery_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s5_policy_value_2}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}
    ${return_value}=    rest delete policy  admin-view  ${statistics_policy_2}
    Should be True      ${return_value}
    change interface role to  delivery      ${sw1_tgdelivery_intf_1}        ${sw1_tgdelivery_alias_1}           s1
    change interface role to  filter        ${sw5_tgfilter_intf_1}          ${sw5_tgfilter_alias_1}             s5        
    [Tags]  full  feature  traffic

TC005: Verify policy statistics across monitoring fabric when policy has one service on core switch S3 
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw3_service_name}         1    
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5    
    ${s1_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${s1_policy_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${s1s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s2s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s2s3_core_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}

    ${s3s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s3s2_core_value}  ${s2s3_core_value}  rangev=10
    Should be true  ${in_range}

    ${s3_pre_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  service_name=${sw3_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s3_pre_value}     ${s3s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s3_post_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  service_name=${sw3_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s3_post_value}    ${s3_pre_value}  rangev=10
    Should be true  ${in_range}

    ${s3s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s3s4_core_value}  ${s3_post_value}  rangev=10
    Should be true  ${in_range}

    ${s4s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s4s3_core_value}  ${s3s4_core_value}  rangev=10
    Should be true  ${in_range}

    ${s4s5_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s4s5_core_value}  ${s4s3_core_value}  rangev=10
    Should be true  ${in_range}

    ${s5s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s5s4_core_value}  ${s4s5_core_value}  rangev=10
    Should be true  ${in_range}

    ${s5_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=delivery   interface_name=${sw5_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s5_policy_value}  ${s5s4_core_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC006: Verify policy statistics across monitoring fabric when policy has two services chained on filter switch S1 and delivery switch S5
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw1_service_name}         1    
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw5_service_name}         2    
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5    

    ${s1_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s1_pre_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_pre_value}     ${s1_policy_value}  rangev=10
    Should be true  ${in_range}

    ${s1_post_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=rx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_post_value}    ${s1_pre_value}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${s1_post_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${s1s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s2s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s2s3_core_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}

    ${s3s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s3s2_core_value}  ${s2s3_core_value}  rangev=10
    Should be true  ${in_range}

    ${s3s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s3_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s3s4_core_value}  ${s3s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s4s3_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s4s3_core_value}  ${s3s4_core_value}  rangev=10
    Should be true  ${in_range}

    ${s4s5_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s4_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s4s5_core_value}  ${s4s3_core_value}  rangev=10
    Should be true  ${in_range}

    ${s5s4_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s5s4_core_value}  ${s4s5_core_value}  rangev=10
    Should be true  ${in_range}

    ${s5_pre_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=tx  service_name=${sw5_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s5_pre_value}     ${s5s4_core_value}  rangev=10
    Should be true  ${in_range}

    ${s5_post_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s5_dpid}  interface_direction=rx  service_name=${sw5_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s5_post_value}    ${s5_pre_value}  rangev=10
    Should be true  ${in_range}

    ${s5_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=delivery   interface_name=${sw5_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s5_policy_value}  ${s5s4_core_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC007: Verify policy statistics across monitoring fabric two policies use same mandatory service.
    change interface role to  filter    ${sw1_tgfilter_intf_2}      ${sw1_tgfilter_alias_2}         s1
    change interface role to  delivery  ${sw2_tgdelivery_intf_2}    ${sw2_tgdelivery_alias_2}       s2
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw2_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw1_service_name}         1    
    Should be True      ${return_value}    
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_2}  1                          {"ether-type": 2048, "dst-tp-port": 8080, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw1_tgfilter_alias_2}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw2_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_2}  ${sw1_service_name}         1    
    Should be True      ${return_value}
    sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${statistics_policy_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${stream1}=  L3 add  flow=a->d  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_d_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:01  dst_mac=00:02:03:04:05:02  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    ${stream2}=  L3 add  flow=b->c  frame_rate=20000  frame_cnt=200000  frame_size=1518  name=b_c_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:06:01  dst_mac=00:02:03:04:06:02  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=8080
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic
    sleep  10
    stop traffic
    sleep  5
    ${report}=  fetch port stats
    ${rx_value_1}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_1}=  verify dict key  ${report}  d  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${rx_value_2}=  verify dict key  ${report}  b  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_2}=  verify dict key  ${report}  c  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0      
 
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
 
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_1}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_1}  100000         rangev=20
    Should be true  ${in_range}    
    ${in_range}=  ixia verify traffic rate  ${rx_value_2}  ${tx_value_2}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_2}  200000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_2}  200000         rangev=20
    Should be true  ${in_range}
    
    ### Verify Traffic Stats for Policy 1    
    ${s1_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}

    ${s1_pre_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_pre_value}     ${s1_policy_value}  rangev=10
    Should be true  ${in_range}

    ${s1_post_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=rx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_post_value}    ${s1_pre_value}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${s1_post_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${s1s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_1}  rangev=10
    Should be true  ${in_range}

    ### Verify Traffic Stats for Policy 2    
    ${s1_policy_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=filter     interface_name=${sw1_tgfilter_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value_2}  rangev=10
    Should be true  ${in_range}

    ${s1_pre_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_pre_value}     ${s1_policy_value}  rangev=10
    Should be true  ${in_range}

    ${s1_post_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=service       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=rx  service_name=${sw1_service_name}  
    ${in_range}=  ixia verify traffic rate  ${s1_post_value}    ${s1_pre_value}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${s1_post_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${s1s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${statistics_policy_2}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_2}  rangev=10
    Should be true  ${in_range}
 
    ### Revert back to clean state 
    ${return_value}=    rest delete policy  admin-view  ${statistics_policy_2}
    Should be True      ${return_value}
    change interface role to  delivery      ${sw1_tgdelivery_intf_1}        ${sw1_tgdelivery_alias_1}           s1
    change interface role to  filter        ${sw2_tgfilter_intf_1}          ${sw2_tgfilter_alias_1}             s2      
    [Tags]  full  feature  traffic
    
TC008: Verify policy statistics across monitoring fabric with a overlapping policy
    change interface role to  delivery  ${sw2_tgdelivery_intf_2}    ${sw2_tgdelivery_alias_2}       s2
    ${return_value}=    rest enable feature    overlap
    Should be True      ${return_value}
    sleep  3    
    ${return_value}=    rest add policy             admin-view  ${policy_name_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${policy_name_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_1}  ${sw2_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add policy             admin-view  ${policy_name_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${policy_name_2}  1                          {"ether-type": 2048, "src-tp-port": 1234, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_2}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_2}  ${sw2_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${policy_name_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${policy_name_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${verify_policy3}=  rest verify bigtap policy  ${policy_name_overlap}  num_filter_intf=1  num_delivery_intf=2
    Should be True      ${verify_policy3}
    ${stream1}=  L3 add  flow=a->d  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_d_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:01  dst_mac=00:02:03:04:05:02  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic
    sleep  10
    stop traffic
    sleep  5
    ${report}=  fetch port stats
    ${rx_value_1}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_1}=  verify dict key  ${report}  d  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_2}=  verify dict key  ${report}  c  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
 
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_1}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_1}  100000         rangev=20
    Should be true  ${in_range}    
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_2}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_2}  100000         rangev=20
    Should be true  ${in_range}

    ### Verify Traffic Stats for Policy 1    
    ${s1_policy_value}=    rest return policy stats  ${policy_name_1}   interface_type=filter     interface_name=${sw1_tgfilter_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${policy_name_1}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_1}  rangev=10
    Should be true  ${in_range}

    ### Verify Traffic Stats for Policy 2    
    ${s1_policy_value}=    rest return policy stats  ${policy_name_2}   interface_type=filter     interface_name=${sw1_tgfilter_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${policy_name_2}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_2}  rangev=10
    Should be true  ${in_range}

    ### Verify Traffic Stats for Overlap Policy 2    
    ${s1_policy_value}=    rest return policy stats  ${policy_name_overlap}   interface_type=filter     interface_name=${sw1_tgfilter_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s1_policy_value}  ${rx_value_1}  rangev=10
    Should be true  ${in_range}

    ${s1s2_core_value}=    rest return policy stats  ${policy_name_overlap}   interface_type=core       stat_info=packet-count    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${in_range}=  ixia verify traffic rate  ${s1s2_core_value}  ${s1_policy_value}  rangev=10
    Should be true  ${in_range}

    ${s2s1_core_value}=    rest return policy stats  ${policy_name_overlap}   interface_type=core       stat_info=packet-count    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${in_range}=  ixia verify traffic rate  ${s2s1_core_value}  ${s1s2_core_value}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${policy_name_overlap}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_2}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_2}  rangev=10
    Should be true  ${in_range}

    ${s2_policy_value}=    rest return policy stats  ${policy_name_overlap}   interface_type=delivery   interface_name=${sw2_tgdelivery_alias_1}     stat_info=packet-count
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${s2s1_core_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${s2_policy_value}  ${tx_value_2}  rangev=10
    Should be true  ${in_range}    

    ### Revert back to clean state 
    ${return_value}=    rest delete policy  admin-view  ${policy_name_1}
    Should be True      ${return_value}
    ${return_value}=    rest delete policy  admin-view  ${policy_name_2}
    Should be True      ${return_value}    
    change interface role to  filter        ${sw2_tgdelivery_intf_2}          ${sw2_tgfilter_alias_1}             s2                   
    ${return_value}=    rest disable feature    overlap
    Should be True      ${return_value}
    [Tags]  full  feature  traffic

TC009: Verify drop counters work when core interface is over-subscribed
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                           {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw4_tgfilter_alias_1}     filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}    delivery 
    Should be True      ${return_value}
    sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=e->h  frame_size=1518  name=e_h_flow  ethertype=0800  frame_rate=2000000  frame_cnt=20000000  
    ...     src_mac=00:02:03:04:05:01  dst_mac=00:02:03:04:05:02  no_arp=True  #line_rate=50
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic  ${stream1}
    sleep  10
    stop traffic  ${stream1}
    sleep  5
    ${report}=  fetch port stats
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5    
    ${s5_delivery_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=core       stat_info=packet-count-rx-drop    switch_dpid=${s5_dpid}  interface_direction=rx  
    ${output_value}=  Convert To Integer  ${s5_delivery_value}
    ${return_value}=  verify value is in range  ${output_value}  100000  100000000      
    Should be True  ${return_value}                                                                        
    [Tags]  full  feature  traffic
                
TC010: Verify drop counters work when delivery interface is over-subscribed
    ## Drop is seen on filter interface
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                           {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw4_tgfilter_alias_1}     filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgfilter_alias_1}     filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}    delivery 
    Should be True      ${return_value}
    sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=2  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=e->h  frame_size=1518  name=e_h_flow  frame_rate=600000  frame_cnt=6000000  ethertype=0800  
    ...     src_mac=00:02:03:04:05:01  dst_mac=00:02:03:04:05:02  no_arp=True  #line_rate=11
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80    
    ${stream2}=  L3 add  flow=g->h  frame_size=1518  name=g_h_flow  frame_rate=600000  frame_cnt=6000000  ethertype=0800  
    ...     src_mac=00:02:03:04:06:01  dst_mac=00:02:03:04:06:02  no_arp=True  #line_rate=11
    ...     src_ip=101.1.1.1  dst_ip=101.1.1.2  protocol=TCP  src_port=2345  dst_port=80
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic 
    sleep  10
    stop traffic    
    sleep  5    
    ${report}=  fetch port stats
    ${s5_dpid}=  rest return switch dpid from ip  s5    
    ${s5_filter_value}=    rest return policy stats  ${statistics_policy_1}   interface_type=filter   interface_name=${sw5_tgfilter_alias_1}    stat_info=packet-count-rx-drop
    ${output_value}=  Convert To Integer  ${s5_filter_value}
    ${return_value}=  verify value is in range  ${output_value}  100000  100000000      
    Should be True  ${return_value}                                                                        
    [Tags]  full  feature  traffic

TC011: Verify switch interface statistics on controller, when filter and delivery interface are on same switch     
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=g->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=g_h_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    cli clear interface statistics  s5
    sleep  10
    start traffic
    sleep  10
    stop traffic    
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  g  transmitted_frames
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${s5_dpid}=  rest return switch dpid from ip  s5        
    ${rx_switch_value}=  rest return switch interface stats  ${s5_dpid}  ${sw5_tgfilter_intf_1}  receive-packets
    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}  ${sw5_tgdelivery_intf_1}  transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${rx_switch_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

TC012: Verify switch interface statistics on controller, when filter and delivery interface are on different switches       
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10
    cli clear interface statistics  s1
    cli clear interface statistics  s2
    cli clear interface statistics  s3
    cli clear interface statistics  s4
    cli clear interface statistics  s5
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1        
    ${s2_dpid}=  rest return switch dpid from ip  s2        
    ${s3_dpid}=  rest return switch dpid from ip  s3        
    ${s4_dpid}=  rest return switch dpid from ip  s4        
    ${s5_dpid}=  rest return switch dpid from ip  s5        

    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_1}      receive-packets

    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_1}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic
                
TC013: Verify switch interface statistics on controller, when multiple policies traverse the core.       
    change interface role to  filter    ${sw1_tgfilter_intf_2}      ${sw1_tgfilter_alias_2}         s1
    change interface role to  delivery  ${sw5_tgdelivery_intf_2}    ${sw5_tgdelivery_alias_2}       s5
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_2}  1                          {"ether-type": 2048, "dst-tp-port": 8080, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw1_tgfilter_alias_2}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw5_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${statistics_policy_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_h_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    ${stream2}=  L3 add  flow=b->g  frame_rate=20000  frame_cnt=200000  frame_size=1518  name=b_g_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=8080
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10    
    cli clear interface statistics  s1
    cli clear interface statistics  s2
    cli clear interface statistics  s3
    cli clear interface statistics  s4
    cli clear interface statistics  s5    
    start traffic
    sleep  10
    stop traffic

    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5        
    ${report}=  fetch port stats

    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_1}      receive-packets

    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_1}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    
    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_2}      receive-packets

    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_2}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_2}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic
    
TC014: Verify switch interface statistics on controller, when policy has one service on core switch S3       
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw3_service_name}         1    
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5
    
    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_1}      receive-packets
    ${in_range}=  ixia verify traffic rate  ${rx_switch_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}
    
    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${s3_pre_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx   service_name=${sw3_service_name}
    ${s3_pre_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_pre_service_intf}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_pre_service_value}         ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${s3_post_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx   service_name=${sw3_service_name}
    ${s3_post_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_post_service_intf}    receive-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_post_service_value}         ${s3_pre_service_value}      rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${s3_post_service_value}     rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_1}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic
        
TC015: Verify switch interface statistics on controller, when policy has two services chained on filter switch S1 and delivery switch S5        
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"any-traffic": true, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw1_service_name}         1    
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw5_service_name}         2    
    Should be True      ${return_value}
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000   
    ...     src_mac=00:11:01:01:01:01  dst_mac=00:11:01:01:01:02  no_arp=True
    ...     src_ip=10.1.101.1  dst_ip=10.1.101.2  name=a_h_flow
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${in_range}=  ixia verify traffic rate  ${rx_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5    

    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_1}      receive-packets
    ${in_range}=  ixia verify traffic rate  ${rx_switch_value}  ${rx_value}  rangev=10
    Should be true  ${in_range}

    ${s1_pre_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx   service_name=${sw1_service_name}
    ${s1_pre_service_value}=        rest return switch interface stats      ${s1_dpid}                   ${s1_pre_service_intf}     transmit-packets    
    ${in_range}=                    ixia verify traffic rate                ${s1_pre_service_value}      ${rx_switch_value}         rangev=10
    Should be true  ${in_range}

    ${s1_post_service_intf}=        rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=rx   service_name=${sw1_service_name}
    ${s1_post_service_value}=       rest return switch interface stats      ${s1_dpid}                   ${s1_post_service_intf}    receive-packets    
    ${in_range}=                    ixia verify traffic rate                ${s1_post_service_value}     ${s1_pre_service_value}    rangev=10
    Should be true  ${in_range}
    
    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                   ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=                    ixia verify traffic rate                ${sw1sw2_core_switch_value}  ${s1_post_service_value}   rangev=10
    Should be true  ${in_range}


    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${s5_pre_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service         stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=tx   service_name=${sw5_service_name}
    ${s5_pre_service_value}=        rest return switch interface stats      ${s5_dpid}                   ${s5_pre_service_intf}         transmit-packets    
    ${in_range}=                    ixia verify traffic rate                ${s5_pre_service_value}      ${sw5sw4_core_switch_value}    rangev=10
    Should be true  ${in_range}

    ${s5_post_service_intf}=        rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx   service_name=${sw5_service_name}
    ${s5_post_service_value}=       rest return switch interface stats      ${s5_dpid}                   ${s5_post_service_intf}    receive-packets    
    ${in_range}=                    ixia verify traffic rate                ${s5_post_service_value}     ${s5_pre_service_value}    rangev=10
    Should be true  ${in_range}
    
    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_1}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${s5_post_service_value}     rangev=10
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}  ${tx_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic

 
TC016: Verify switch interface statistics on controller, when two policies use same mandatory service.       
    change interface role to  filter    ${sw1_tgfilter_intf_2}      ${sw1_tgfilter_alias_2}         s1
    change interface role to  delivery  ${sw5_tgdelivery_intf_2}    ${sw5_tgdelivery_alias_2}       s5
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_1}  ${sw5_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_1}  ${sw3_service_name}         1    
    Should be True      ${return_value}
    
    ${return_value}=    rest add policy             admin-view  ${statistics_policy_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${statistics_policy_2}  1                          {"ether-type": 2048, "dst-tp-port": 8080, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw1_tgfilter_alias_2}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${statistics_policy_2}  ${sw5_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add service to policy  admin-view  ${statistics_policy_2}  ${sw3_service_name}         1    
    Should be True      ${return_value}
        
    Sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${statistics_policy_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${statistics_policy_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${stream1}=  L3 add  flow=a->h  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_h_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    ${stream2}=  L3 add  flow=b->g  frame_rate=20000  frame_cnt=200000  frame_size=1518  name=b_g_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:06  dst_mac=00:02:03:04:05:07  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=8080
    clear stats
    cli     node=master    cmd=clear bigtap statistics
    sleep  10    
    cli clear interface statistics  s1
    cli clear interface statistics  s2
    cli clear interface statistics  s3
    cli clear interface statistics  s4
    cli clear interface statistics  s5    
    start traffic
    sleep  10
    stop traffic
    ${report}=  fetch port stats
    ${rx_value_1}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_1}=  verify dict key  ${report}  h  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${rx_value_2}=  verify dict key  ${report}  b  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_2}=  verify dict key  ${report}  g  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0          
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
    ${s3_dpid}=  rest return switch dpid from ip  s3
    ${s4_dpid}=  rest return switch dpid from ip  s4
    ${s5_dpid}=  rest return switch dpid from ip  s5        
    ${report}=  fetch port stats
    ${service_traffic}=     Evaluate    ${rx_value_1}+${rx_value_2}
    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_1}      receive-packets

    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${s3_pre_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx   service_name=${sw3_service_name}
    ${s3_pre_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_pre_service_intf}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_pre_service_value}         ${service_traffic}          rangev=10
    Should be true  ${in_range}

    ${s3_post_service_intf}=         rest return policy stats                ${statistics_policy_1}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx   service_name=${sw3_service_name}
    ${s3_post_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_post_service_intf}    receive-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_post_service_value}         ${service_traffic}           rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_1}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_1}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    
    ${rx_switch_value}=  rest return switch interface stats  ${s1_dpid}     ${sw1_tgfilter_intf_2}      receive-packets

    ${sw1sw2_core_interface}=       rest return policy stats                ${statistics_policy_2}      interface_type=core        stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx        
    ${sw1sw2_core_switch_value}=    rest return switch interface stats      ${s1_dpid}                  ${sw1sw2_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw1sw2_core_switch_value}     ${rx_switch_value}          rangev=10
    Should be true  ${in_range}

    ${sw2sw1_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx        
    ${sw2sw1_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw1_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw1_core_switch_value}     ${sw1sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw2sw3_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=tx        
    ${sw2sw3_core_switch_value}=    rest return switch interface stats      ${s2_dpid}                   ${sw2sw3_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw2sw3_core_switch_value}     ${sw2sw1_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw3sw2_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx        
    ${sw3sw2_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw2_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw2_core_switch_value}     ${sw2sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${s3_pre_service_intf}=         rest return policy stats                ${statistics_policy_2}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx   service_name=${sw3_service_name}
    ${s3_pre_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_pre_service_intf}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_pre_service_value}         ${service_traffic}          rangev=10
    Should be true  ${in_range}

    ${s3_post_service_intf}=         rest return policy stats                ${statistics_policy_2}       interface_type=service     stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=rx   service_name=${sw3_service_name}
    ${s3_post_service_value}=        rest return switch interface stats      ${s3_dpid}                   ${s3_post_service_intf}    receive-packets    
    ${in_range}=  ixia verify traffic rate  ${s3_post_service_value}         ${service_traffic}           rangev=10
    Should be true  ${in_range}

    ${sw3sw4_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s3_dpid}  interface_direction=tx        
    ${sw3sw4_core_switch_value}=    rest return switch interface stats      ${s3_dpid}                   ${sw3sw4_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw3sw4_core_switch_value}     ${sw3sw2_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw4sw3_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=rx        
    ${sw4sw3_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw3_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw3_core_switch_value}     ${sw3sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}    

    ${sw4sw5_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s4_dpid}  interface_direction=tx        
    ${sw4sw5_core_switch_value}=    rest return switch interface stats      ${s4_dpid}                   ${sw4sw5_core_interface}   transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${sw4sw5_core_switch_value}     ${sw4sw3_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${sw5sw4_core_interface}=       rest return policy stats                ${statistics_policy_2}       interface_type=core        stat_info=interface    switch_dpid=${s5_dpid}  interface_direction=rx        
    ${sw5sw4_core_switch_value}=    rest return switch interface stats      ${s5_dpid}                   ${sw5sw4_core_interface}   receive-packets    
    ${in_range}=  ixia verify traffic rate  ${sw5sw4_core_switch_value}     ${sw4sw5_core_switch_value}  rangev=10
    Should be true  ${in_range}

    ${tx_switch_value}=  rest return switch interface stats  ${s5_dpid}     ${sw5_tgdelivery_intf_2}     transmit-packets    
    ${in_range}=  ixia verify traffic rate  ${tx_switch_value}              ${sw5sw4_core_switch_value}  rangev=10
    Should be true  ${in_range}
    [Tags]  full  feature  traffic
        
TC017: Verify switch interface statistics on controller, with an overlapping policy       
    change interface role to  delivery  ${sw2_tgdelivery_intf_2}    ${sw2_tgdelivery_alias_2}       s2
    ${return_value}=    rest enable feature    overlap
    Should be True      ${return_value}
    sleep  3    
    ${return_value}=    rest add policy             admin-view  ${policy_name_1}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${policy_name_1}  1                          {"ether-type": 2048, "dst-tp-port": 80, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_1}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_1}  ${sw2_tgdelivery_alias_1}  delivery 
    Should be True      ${return_value}
    ${return_value}=    rest add policy             admin-view  ${policy_name_2}  forward
    Should be True      ${return_value}
    ${return_value}=    rest add policy match       admin-view  ${policy_name_2}  1                          {"ether-type": 2048, "src-tp-port": 1234, "ip-proto": 6, "sequence": 1}
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_2}  ${sw1_tgfilter_alias_1}    filter
    Should be True      ${return_value}
    ${return_value}=    rest add policy interface   admin-view  ${policy_name_2}  ${sw2_tgdelivery_alias_2}  delivery 
    Should be True      ${return_value}
    sleep  10
    ${verify_policy1}=  rest verify bigtap policy  ${policy_name_1}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy1}
    ${verify_policy2}=  rest verify bigtap policy  ${policy_name_2}  num_filter_intf=1  num_delivery_intf=1
    Should be True      ${verify_policy2}
    ${verify_policy3}=  rest verify bigtap policy  ${policy_name_overlap}  num_filter_intf=1  num_delivery_intf=2
    Should be True      ${verify_policy3}
    ${stream1}=  L3 add  flow=a->d  frame_rate=10000  frame_cnt=100000  frame_size=1518  name=a_d_flow  ethertype=0800  
    ...     src_mac=00:02:03:04:05:01  dst_mac=00:02:03:04:05:02  no_arp=True
    ...     src_ip=100.1.1.1  dst_ip=100.1.1.2  protocol=TCP  src_port=1234  dst_port=80
    clear stats    
    cli     node=master    cmd=clear bigtap statistics
    clear stats    
    sleep  10
    start traffic
    sleep  10
    stop traffic
    sleep  5
    ${report}=  fetch port stats
    ${rx_value_1}=  verify dict key  ${report}  a  transmitted_frames
    ${output_value}=  Convert To Integer  ${rx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_1}=  verify dict key  ${report}  d  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_1}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${tx_value_2}=  verify dict key  ${report}  c  received_valid_frames
    ${output_value}=  Convert To Integer  ${tx_value_2}
    Should Not Be Equal As Integers  ${output_value}  0      
    ${s1_dpid}=  rest return switch dpid from ip  s1
    ${s2_dpid}=  rest return switch dpid from ip  s2
 
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_1}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_1}  100000         rangev=20
    Should be true  ${in_range}    
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  ${tx_value_2}  rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${rx_value_1}  100000         rangev=20
    Should be true  ${in_range}
    ${in_range}=  ixia verify traffic rate  ${tx_value_2}  100000         rangev=20
    Should be true  ${in_range}

    ${s1_finterface}=       rest return policy stats                ${policy_name_overlap}      interface_type=filter    interface_name=${sw1_tgfilter_alias_2}     stat_info=interface
    ${s1_fintf_value}=      rest return switch interface stats      ${s1_dpid}                  ${s1_finterface}         receive-packets    
    ${in_range}=            ixia verify traffic rate                ${s1_fintf_value}           ${rx_value_1}            rangev=10
    Should be true  ${in_range}

    ${s1s2_core_intf}=      rest return policy stats                ${policy_name_overlap}      interface_type=core       stat_info=interface    switch_dpid=${s1_dpid}  interface_direction=tx  
    ${s1s2_fintf_value}=    rest return switch interface stats      ${s1_dpid}                  ${s1s2_core_intf}         transmit-packets    
    ${in_range}=            ixia verify traffic rate                ${s1s2_fintf_value}         ${s1_fintf_value}         rangev=10
    Should be true  ${in_range}

    ${s2s1_core_intf}=      rest return policy stats                ${policy_name_overlap}      interface_type=core       stat_info=interface    switch_dpid=${s2_dpid}  interface_direction=rx  
    ${s2s1_fintf_value}=    rest return switch interface stats      ${s2_dpid}                  ${s2s1_core_intf}         receive-packets    
    ${in_range}=            ixia verify traffic rate                ${s2s1_fintf_value}         ${s1s2_fintf_value}       rangev=10
    Should be true  ${in_range}

    ${s2_dinterface1}=      rest return policy stats                ${policy_name_overlap}      interface_type=delivery   interface_name=${sw2_tgdelivery_alias_2}     stat_info=interface
    ${s2_dintf_value1}=     rest return switch interface stats      ${s2_dpid}                  ${s2_dinterface1}         transmit-packets    
    ${in_range}=            ixia verify traffic rate                ${s2_dintf_value1}          ${s2s1_fintf_value}       rangev=10
    Should be true  ${in_range}
    ${in_range}=            ixia verify traffic rate                ${s2_dintf_value1}          ${tx_value_1}             rangev=10
    Should be true  ${in_range}

    ${s2_dinterface2}=      rest return policy stats                ${policy_name_overlap}      interface_type=delivery   interface_name=${sw2_tgdelivery_alias_1}     stat_info=interface
    ${s2_dintf_value2}=     rest return switch interface stats      ${s2_dpid}                  ${s2_dinterface2}         transmit-packets    
    ${in_range}=            ixia verify traffic rate                ${s2_dintf_value2}          ${s2s1_fintf_value}       rangev=10
    Should be true  ${in_range}
    ${in_range}=            ixia verify traffic rate                ${s2_dintf_value2}          ${tx_value_2}             rangev=10
    Should be true  ${in_range}   
    [Tags]  full  feature  traffic
    

                                                      
* Keywords
statistics suite setup
    base suite setup
    ${return_value}=    rest disable feature    inport-mask
    Should be True      ${return_value}
    ${return_value}=    rest add switch alias   s1   ${sw1_alias}
    Should be True      ${return_value}    
    ${return_value}=    rest add switch alias   s2   ${sw2_alias}
    Should be True      ${return_value}
    ${return_value}=    rest add switch alias   s3   ${sw3_alias}
    Should be True      ${return_value}
    ${return_value}=    rest add switch alias   s4   ${sw4_alias}
    Should be True      ${return_value}
    ${return_value}=    rest add switch alias   s5   ${sw5_alias}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s1  ${sw1_tgfilter_intf_1}             filter                      ${sw1_tgfilter_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s1  ${sw1_tgdelivery_intf_1}           delivery                    ${sw1_tgdelivery_alias_1}
    Should be True      ${return_value}

    ${return_value}=    rest add interface role  s1  ${sw1_pre_service_interface}     service                     ${sw1_pre_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s1  ${sw1_post_service_interface}    service                     ${sw1_post_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s5  ${sw5_pre_service_interface}     service                     ${sw5_pre_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s5  ${sw5_post_service_interface}    service                     ${sw5_post_service_name}
    Should be True      ${return_value}

    ${return_value}=    rest add interface role  s2  ${sw2_tgfilter_intf_1}             filter                      ${sw2_tgfilter_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s2  ${sw2_tgdelivery_intf_1}           delivery                    ${sw2_tgdelivery_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s3  ${sw3_pre_service_interface}       service                     ${sw3_pre_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s3  ${sw3_post_service_interface}      service                     ${sw3_post_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s4  ${sw4_tgfilter_intf_1}             filter                      ${sw4_tgfilter_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s4  ${sw4_tgdelivery_intf_1}           delivery                    ${sw4_tgdelivery_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s5  ${sw5_tgfilter_intf_1}             filter                      ${sw5_tgfilter_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add interface role  s5  ${sw5_tgdelivery_intf_1}           delivery                    ${sw5_tgdelivery_alias_1}
    Should be True      ${return_value}
    ${return_value}=    rest add service         ${sw1_service_name}                    ${sw1_pre_service_name}   ${sw1_post_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add service         ${sw5_service_name}                  ${sw5_pre_service_name}   ${sw5_post_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest add service         ${sw3_service_name}                    ${sw3_pre_service_name}   ${sw3_post_service_name}
    Should be True      ${return_value}
    sleep  10

change interface role to  [Arguments]  ${new_role}   ${interface_name}   ${interface_alias}     ${node}
    ${return_value}=    rest add interface role  ${node}    ${interface_name}     ${new_role}      ${interface_alias}
    Should be True      ${return_value}

statistics test setup
    ${result1}=  write version to file
    Should be true  ${result1}
    ${result}=  start syslog monitor
    Should be true  ${result}
    cli clear interface statistics  s1
    cli clear interface statistics  s2
    cli clear interface statistics  s3
    cli clear interface statistics  s4
    cli clear interface statistics  s5

statistics test teardown
    delete traffic
    ${return_value}=    rest delete policy  admin-view  ${statistics_policy_1}
    Should be True      ${return_value}
    cli clear interface statistics  s1
    cli clear interface statistics  s2
    cli clear interface statistics  s3
    cli clear interface statistics  s4
    cli clear interface statistics  s5
    ${result1}=  stop syslog monitor
    Should be true  ${result1}
    
    
statistics suite teardown
    ${return_value}=    rest delete service  ${sw1_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest delete service  ${sw5_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest delete service  ${sw3_service_name}
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s1  ${sw1_tgfilter_intf_1}      filter      ${sw1_tgfilter_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s1  ${sw1_tgdelivery_intf_1}    delivery    ${sw1_tgdelivery_alias_1} 
    Should be True      ${return_value}

    ${return_value}=    rest delete interface role  s1  ${sw1_pre_service_interface}    service    ${sw1_pre_service_name} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s5  ${sw5_pre_service_interface}    service    ${sw5_pre_service_name} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s1  ${sw1_post_service_interface}   service    ${sw1_post_service_name} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s5  ${sw5_post_service_interface}   service    ${sw5_post_service_name} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s3  ${sw3_pre_service_interface}    service    ${sw3_pre_service_name} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s3  ${sw3_post_service_interface}   service    ${sw3_post_service_name} 
    Should be True      ${return_value}    
    ${return_value}=    rest delete interface role  s2  ${sw2_tgfilter_intf_1}      filter      ${sw2_tgfilter_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s2  ${sw2_tgdelivery_intf_1}    delivery    ${sw2_tgdelivery_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s4  ${sw4_tgfilter_intf_1}      filter      ${sw4_tgfilter_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s4  ${sw4_tgdelivery_intf_1}    delivery    ${sw4_tgdelivery_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s5  ${sw5_tgfilter_intf_1}      filter      ${sw5_tgfilter_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface role  s5  ${sw5_tgdelivery_intf_1}    delivery    ${sw5_tgdelivery_alias_1} 
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s1  ${sw1_tgfilter_intf_1}      switch_alias=${sw1_alias}
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s1  ${sw1_tgdelivery_intf_1}    switch_alias=${sw1_alias}    
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s2  ${sw2_tgfilter_intf_1}      switch_alias=${sw2_alias}
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s2  ${sw2_tgdelivery_intf_1}    switch_alias=${sw2_alias}    
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s4  ${sw4_tgfilter_intf_1}      switch_alias=${sw4_alias}
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s4  ${sw4_tgdelivery_intf_1}    switch_alias=${sw4_alias}    
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s5  ${sw5_tgfilter_intf_1}      switch_alias=${sw5_alias}
    Should be True      ${return_value}
    ${return_value}=    rest delete interface       s5  ${sw5_tgdelivery_intf_1}    switch_alias=${sw5_alias}    
    Should be True      ${return_value}                
    ${return_value}=    rest delete switch alias  s1
    Should be True      ${return_value}
    ${return_value}=    rest delete switch alias  s2
    Should be True      ${return_value}
    ${return_value}=    rest delete switch alias  s3    
    Should be True      ${return_value}
    ${return_value}=    rest delete switch alias  s4
    Should be True      ${return_value}
    ${return_value}=    rest delete switch alias  s5    
    Should be True      ${return_value}
    ${return_value}=    rest delete switch  s1
    Should be True      ${return_value}
    ${return_value}=    rest delete switch  s2
    Should be True      ${return_value}
    ${return_value}=    rest delete switch  s3    
    Should be True      ${return_value}
    ${return_value}=    rest delete switch  s4
    Should be True      ${return_value}
    ${return_value}=    rest delete switch  s5    
    Should be True      ${return_value}
    base suite teardown  
