* Settings
Documentation    T5 Test Suite
Suite Setup      base suite setup
Suite Teardown   base suite teardown
Test Setup       base test setup
Test Teardown    base test teardown
Force Tags       T5 
Library          keywords/BsnCommon.py
Library          keywords/Controller.py
Library			 keywords/Mininet.py
Library		     keywords/Host.py
Library		     keywords/Ixia.py
Library		     keywords_dev/mingtao/T5_longevity.py
Library	         keywords/T5.py
Library	         keywords/T5Platform.py
Library	         keywords/Controller.py
 
Resource	     testsuites_dev/mingtao/T5_mingtao_resource.txt 

* Variable
 
${short}  1
${medium}  10
${long}   30
${verylong}    120 
${gw}           10.192.64.1
${dns}          10.192.3.1
${domain}        bigswitch.com 
${mask}	         18
${VIP1}         10.192.105.150
${VIP2}         10.192.105.151
${namec1}       MY-T5-C30
${namec2}       MY-T5-C10
${ipcno}        10.192.105.255

* Test Case

Set variable
	${ipc1}=   get node ip   c1
	Set Suite Variable    ${ipc1}
	${ipc2}=   get node ip   c2
	Set Suite Variable    ${ipc2}
 	${time}=  Get Time     year,month,day
 	${file}=  Set Variable  config${time[0]}${time[1]}${time[2]}
	Set Suite Variable       ${file} 		
  
	[Tags] 	sanity   feature  rerun


# fist boot with static ip with dual controllers
T1.1 first boot of controller in HA mode via static IP after boot factory default
	log   VIP_runningconfig_factorydefault_vip_runningconfig
 	 
#	Verify VIP function 	 ${VIP1}   	
#	Cli Copy  running-config   scp://bsn@qa-kvm-32:/home/mingtao/${file}    scp_passwd=bsn
# 	${A}=   cli_take_snapshot   master  run_config=yes	
	
 	cli_boot_factory_default	c1
 	cli_boot_factory_default	c2
	sleep  ${verylong}	
  	controller first boot static        c1  no  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
    controller first boot static 2nd    c2  yes  no    ${ipc2}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec2}     ${ipc1}

	rest_verify_show_cluster
#	Cli Copy   scp://bsn@qa-kvm-32:/home/mingtao/${file}  running-config  scp_passwd=bsn
#	${B}=   cli_take_snapshot   master   run_config=yes		
#  	Should Be Equal    ${A}    ${B}	 	
#	Verify VIP function 	 ${VIP2}
	
   	log   failed for VIP and copy running config
   
	[Tags] 	sanity   firstboot   VIP  JIRA-BSC-5055   JIRA-BSC-5041  HA
	
T1.2 Verify the VIP change after the first boot
     Log   covered in first boot T1.1
     
	[Tags] 	sanity    firstboot  VIP   JIRA-BSC-5055   HA


T1.3 Factory default options
    Log   covered in first boot T1.1
     
	[Tags] 	sanity   firstboot   HA

T1.4 Verify config restore after the first boot
     Log   covered in first boot T1.1
	[Tags] 	sanity    firstboot   JIRA-BSC-5041  HA


T1.5 Test controller reboot
 	reboot node and verify it role
 
	[Tags] 	sanity  infra  HA 

T1.6 Verification of CLI commands (whoami , ping , set length , history , reauth)
	log   cli with admin and non admin	 
	Test whoami ping reauth with admin
	Test whoami ping reauth with non admin  
    log  manual pass for: set length,history
	
	[Tags] 	feature    cli   HA

T1.7 Traceroute
	Log  traceroute in bash, verified in HA and standalone
    Manual passed
	[Tags] 	feature  infra  Manual  HA   

T1.8 Watch debug command output
    Log  watch debug/delete is not useful
    Manual failed
	[Tags]  feature   cli  Manual   HA


T1.9 Verify first boot of controller when Master and Slave are in different time zones  
 	Verify NTP time zone   c1    America/Los_Angeles   
 	Verify NTP time zone   c2    America/New_York
 	cli_boot_factory_default	c1
	cli_boot_factory_default	c2 	
	sleep  ${verylong}	
  	controller first boot static        c1  no  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
    controller first boot static 2nd    c2  yes  no    ${ipc2}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec2}     ${ipc1}
 	Verify NTP time zone   c1    America/Los_Angeles   
 	Verify NTP time zone   c2    America/New_York
       	
   	[Tags]  feature  firstboot  ntp  HA


T1.10 first boot of controller join an non existing cluster 
#	cli_boot_factory_default	c2 	
#	sleep  ${verylong}	 
#  	controller first boot static        c1  no  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
  	
#  	first_boot_controller_initial_node_setup        c2  no   ${ipc2}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec2}
#	first_boot_controller_initial_cluster_setup 	c2  yes   cluster_ip=${ipcno}
#	first_boot_controller_menu_apply_negative	    c2    cluster_ip=${ipc1}
	Manual failed	   	
	[Tags] 	sanity    firstboot    JIRA-BSC-5087  HA



 
## first boot with single controller	 
T2.1 first boot of controller in standalone via static IP after boot factory default	
 	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	controller first boot static        c1  no  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	Verification local node config      c1   ${namec1}   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain} 	
  	
	[Tags] 	sanity  firstboot    

T2.2 Test first boot of controller menu node for standalone
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_recovery             c1  adminadmin
	first_boot_controller_menu_IP                   c1  ${ipc1}   ${mask}  
	first_boot_controller_menu_gateway   			c1  ${gw}
	first_boot_controller_menu_dnsserver            c1  ${dns}  
	first_boot_controller_menu_domain	            c1  ${domain}
	first_boot_controller_menu_name                 c1  ${namec1}
	first_boot_controller_menu_apply                c1
 
	[Tags] 	sanity  firstboot

 
T2.3 Verify with invalid DNS server IP address
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no  
	first_boot_controller_menu_dnsserver            c1   300.0.0.1     invalid_input=True
	first_boot_controller_menu_dnsserver            c1   100.0.0.1.0   invalid_input=True
	Log   broadcast as dns server address
#	first_boot_controller_menu_dnsserver            c1   255.255.255.255   invalid_input=True	
#	first_boot_controller_menu_dnsserver            c1   224.0.0.0   invalid_input=True	
	first_boot_controller_menu_dnsserver            c1   2f.3f.0.0   invalid_input=True	
	first_boot_controller_menu_dnsserver            c1   0.0.0.0     invalid_input=True		
	first_boot_controller_menu_dnsserver            c1   ${dns}   
	first_boot_controller_menu_apply                c1	
    
	[Tags] 	feature     firstboot   JIRA-BSC-5031   
 
 
T2.4 Verify with invalid mask
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no  
	first_boot_controller_menu_prefix               c1   35   invalid_input=True
	first_boot_controller_menu_prefix               c1   32   invalid_input=True
	first_boot_controller_menu_prefix               c1   31   invalid_input=True				
	log    0 is accepted as valid mask
#	first_boot_controller_menu_prefix               c1   0   invalid_input=True	
	first_boot_controller_menu_prefix               c1   ${mask}    
 	first_boot_controller_menu_apply                c1	
    
	[Tags] 	feature   firstboot     JIRA-BSC-5032    
 
  
T2.5 Verify with invalid IP
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no  
	first_boot_controller_menu_IP                   c1   300.0.0.1     invalid_input=True
    log   broadcast address   
#	first_boot_controller_menu_IP                   c1   255.255.255.255    18   invalid_input=True	
#	first_boot_controller_menu_IP                   c1   224.0.0.0    18   invalid_input=True
	first_boot_controller_menu_IP                   c1   0.0.0.0      18   invalid_input=True	
	first_boot_controller_menu_IP                   c1   100.100.100.100.100      18   invalid_input=True	
	first_boot_controller_menu_IP                   c1   1f.2f.3f.0      18   invalid_input=True			
	first_boot_controller_menu_IP                   c1   ${ipc1}/${mask}  			 
	first_boot_controller_menu_apply                c1	
    
	[Tags] 	feature   firstboot  JIRA-BSC-5031    

T2.7 Test first boot of controller menu cluster for standalone
#	cli_boot_factory_default	c1
#	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_cluster_name         c1  MY-T5-C1
	first_boot_controller_menu_cluster_desr         c1  MY-T5-controller  
	first_boot_controller_menu_cluster_passwd   	c1  adminadmin
 	first_boot_controller_menu_apply                c1
 
	[Tags] 	feature  firstboot   


T2.8 Test first boot of controller menu update cluster  
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_cluster_option_apply         c1    	 
 
	[Tags] 	sanity     firstboot   
		
T2.9 Test first boot of controller menu update cluster from join to new (ntp need to be configured)
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  yes   cluster_ip=10.192.105.30 
	first_boot_controller_menu_cluster_option_apply         c1    cluster_name=MY-T5	 


	[Tags] 	sanity     firstboot 	 

T2.10 Test first boot of controller menu invalid cluster name
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_cluster_name         c1     name=MY-T5,	  invalid_input=True	
	first_boot_controller_menu_cluster_name         c1     name=1MY-T5 	  invalid_input=True	
	first_boot_controller_menu_cluster_name         c1     name=_MY-T5 	  invalid_input=True
	first_boot_controller_menu_cluster_name         c1     name=.MY-T5 	  invalid_input=True
	first_boot_controller_menu_cluster_name         c1     name=-MY-T5 	  invalid_input=True
	first_boot_controller_menu_cluster_name         c1     name=MY.T5
	first_boot_controller_menu_apply                c1
		 			
	[Tags] 	sanity     firstboot 	 
 

T2.11 Test first boot of controller menu reset and start over for standalone
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_reset                c1   
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
 
	first_boot_controller_menu_apply                c1
 
	[Tags] 	sanity     firstboot 	 

 
T2.12 Verify the behavior if user hits Ctrl+C during various stages of the first boot process
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_ctl_c      	            c1
	first_boot_controller_initial_cluster_setup 	c1  no  
 	first_boot_controller_ctl_c                     c1
 	first_boot_controller_menu_apply                c1   	
 	log  need to care the ctl_c after the apply
 	    
	[Tags] 	feature   firstboot    JIRA-BSC_5064

 
	  
#  first boot with dhcp  
T3.1 Verify first boot of controller in standalone mode via dhcp
	 
	cli_boot_factory_default	c1
	sleep  ${verylong}
  	${ip}=  first_boot_controller     c1  no  yes  
  	sleep    ${long}
 	${result}=  rest_controller_add_ip    ${ip}    ${ipc1}   ${mask}    yes 
 	Should be True     ${result}   	  	    
	[Tags] 	sanity   firstboot   dhcp	 standalone   rerun
 	

T3.2 Verify first boot of controller in HA mode via dhcp
	log   need to add copy config and compare config back  
#	${A}=   cli_take_snapshot   master  run_config=yes	
#	Cli Copy  running-config   scp://bsn@qa-kvm-32:/home/mingtao/config_try    scp_passwd=bsn
 	cli_boot_factory_default	c1
	sleep  ${verylong}
  	${ip1}=  first_boot_controller    c1  no  yes    hostname=MY-T5-C1 	
	cli_boot_factory_default	c2
	sleep  ${verylong}  
  	${ip2}=  first_boot_controller    c2  yes  yes   hostname=MY-T5-C2   cluster_ip=${ip1}  
  	sleep    ${long} 	
	rest_verify_show_cluster  c1=${ip1}   c2=${ip2}  	  	
 	${result}=  rest_controller_add_ip    ${ip1}   ${ipc1}   18    yes
 	${result}=  rest_controller_add_ip    ${ip2}   ${ipc2}   18    yes 
 	 Should be True     ${result}   	
#	Cli Copy   scp://bsn@qa-kvm-32:/home/mingtao/config_try  running-config  scp_passwd=bsn  
# 	${B}=   cli_take_snapshot   master   run_config=yes			
# 	Should Be Equal    ${A}    ${B}	 
  	    
	[Tags] 	sanity    JIRA-BSC-5041    firstboot   dhcp   HA   rerun

T3.3 Verify controller IP change after the first boot
    log   convered in T2.1 and T2.2
	[Tags] 	sanity   firstboot    rerun



#####


T4.1 Verify first boot of controller when external DNS/NTP server is unreachable
	cli_boot_factory_default	c1
	sleep  ${verylong}	
  	first_boot_controller_initial_node_setup        c1  no   ${ipc1}   ${mask}   ${gw}   ${dns}   ${domain}   ${namec1}
	first_boot_controller_initial_cluster_setup 	c1  no   
	first_boot_controller_menu_gateway   			c1  10.192.64.7  
	first_boot_controller_menu_dnsserver            c1  8.8.8.8  	      
	first_boot_controller_menu_apply_negative       c1   gateway=${gw}   dns=${dns}
 	   
	[Tags] 	feature  firstboot  

 

T4.2 Verification of configs in local node mode 
	log   covered in T2.1   
	[Tags] 	sanity  firstboot  cli

 

T4.3 Controller installation with minimum/maximum supported cpu/memory configuration
	log  manual verified with #1381
	log  warning message -Warning: Minimum recommendation is 2 CPU cores   
	log  warning message -Warning: Minimum recommendation is 2.00 GB of memory 		 
	log  only warning message is given	 
    
	[Tags] 	sanity   Manual  firstboot

T4.4 Shutdown the controller (need to automate)
	log  manual verified with #1381 
	log  "MY-T5-C10# system shutdown"
	log  "MY-T5-C10 shut off"
	log  "virsh start MY-T5-C10"	 
	log  able to ssh admin@10.192.105.10
  
	[Tags] 	sanity   Manual  infra


T4.5 Verification of tech-support and related commands  
	log  no command: show tech-support
    Manual Failed
	[Tags] 	sanity  Manual  cli  infra

 

#########  
 
Verify first boot of controller on bare metal server
    Manual untested
	[Tags] 	sanity    Manual   untested    firstboot


Change IP Tables/ Firewalls
    Manual untested
	[Tags] 	sanity    Manual   untested

 
First boot process in a appliance
    Manual untested
	[Tags] 	sanity    Manual   untested   firstboot
 
 
 
	
