*** Settings ***
Documentation  		Testing File Management - copying RC to other locations
Suite Setup  		Base Suite Setup
Suite Teardown   	Base Suite Teardown
Test Setup   		Setup
Test Teardown  		Teardown
Force Tags   		Platform  Sanity  File Management
Library  			keywords/BsnCommon.py
Library  			keywords_dev/tomasz/T5.py
Library        		String


*** Variables ***
${scp}				scp://recovery@10.197.128.37:scp
${scp RC}			scp://recovery@10.197.128.37:config-RC
${scp file}			scp://recovery@10.197.128.37:config-file
${scp config}		scp://recovery@10.197.128.37:config-config-scp
${scp double}		scp://scp://recovery@10.197.128.37:config-scp
${scp location}		recovery@10.197.128.37:config-scp
${scp inexistent}   scp://recovery@10.197.128.37:inexistent
${file}				config-file
${config}			config://config-config
${config double}	config://config://config-config
${config name}		config-config
${image}			image://image-file
${image double}		image://image://image-file


*** Test Cases ***
T1.1 Copy running config to file
	Cli Copy  running-config  ${file}
	Compare RC with File Line By Line  ${file}
	Compare  running-config  ${file}

T1.2 Copy running config to config://
	Cli Copy  running-config  ${config}
	Compare RC with Config Line By Line  ${config}
	Compare  running-config  ${config}

T1.3 Copy running config to scp://
	Cli Copy Scp  running-config  ${scp}
	Compare Scp  running-config  ${scp}


T2.1 Copy running config to file, change RC, verify configs different
	Cli Copy  running-config  ${file}
	Modify Running Config
	Compare RC with File Line By Line Negative  ${file}
	Compare Negative  running-config  ${file}

T2.2 Copy running config to config://, change RC, verify configs different
	Cli Copy  running-config  ${config}
	Modify Running Config
	Compare RC with Config Line By Line Negative  ${config}
	Compare Negative  running-config  ${config}

T2.3 Copy running config to scp://, change RC, verify configs different
	Cli Copy Scp  running-config  ${scp}
	Modify Running Config
	Compare Scp Negative  running-config  ${scp}


T3.1 Verify deletion of file
	Cli Copy  running-config  ${file}
	Cli Delete  ${file}

T3.2 Verify deletion of inexistent file
	Run Keyword and Expect Error  *Error: Invalid Use: File "*" not found*  Cli Delete  inexistent

T3.3 Verify deletion of config://file
	Cli Copy  running-config  ${config}
	Cli Delete  ${config}

T3.4 Verify deletion of inexistent config://file
	Run Keyword and Expect Error  *Error: Invalid Use: * does not exist*  Cli Delete  config://inexistent


T4.1 Copy running config to file, change RC, restore, verify no change in RC
	Cli Copy  running-config  ${file}
	${tenant}  Generate Random Name  Tenant  5
	Rest Add Tenant  ${tenant}
	Cli Copy  running-config  backup
	Cli Copy  ${file}  running-config
	${status} =  Cli Compare Running Config with File Line By Line  backup
	Should Be True  ${status}
	Compare  running-config  backup

T4.2 Copy running config to config://, change RC, restore, verify old RC restored
	Cli Copy  running-config  ${config}
	Modify Running Config
	Cli Copy  ${config}  running-config
	Compare RC with Config Line By Line  ${config}
	${status} =  Cli Compare Running Config with Config Line By Line  ${config name}
	Should Be True  ${status}
	Compare  running-config  ${config}

T4.3 Copy running config to scp://, change RC, restore, verify no change in RC
	Cli Copy Scp  running-config  ${scp}
	Modify Running Config
	Cli Copy  running-config  backup
	Cli Copy Scp  ${scp}  running-config
	${status} =  Cli Compare Running Config with File Line By Line  backup
	Should Be True  ${status}
	${status} =  Cli Compare Scp  running-config  ${scp}
	Should Not Be True  ${status}
	${status} =  Cli Compare Scp  ${scp}  running-config
	Should Not Be True  ${status}
	${status} =  Cli Compare  running-config  backup
	Should Be True  ${status}
	${status} =  Cli Compare  backup  running-config
	Should Be True  ${status}


T5.1 Copy running config to file, copy RC from file to other file, verify
	Cli Copy  running-config  ${file}
	Cli Copy  ${file}  file-new
	${status} =  Cli Compare Running Config with File Line By Line  file-new
	Should Be True  ${status}
	${status} =  Cli Compare  running-config  file-new
	Should Be True  ${status}
	${status} =  Cli Compare  file-new  running-config
	Should Be True  ${status}

T5.2 Copy running config to file, copy RC from file to scp://, verify
	Cli Copy  running-config  ${file}
	Cli Copy Scp  ${file}  ${scp}
	${status} =  Cli Compare Scp  running-config  ${scp}
	Should Be True  ${status}
	${status} =  Cli Compare Scp  ${scp}  running-config
	Should Be True  ${status}

T5.3 Copy running config to config://, copy RC from config:// to file, verify
	Cli Copy  running-config  ${file}
	Run Keyword and Expect Error  *Error: Invalid Use: file not config file*  Cli Copy  ${file}  config://config-new

T5.4 Copy running config to config://, copy RC from config:// to scp://, verify
	Cli Copy  running-config  ${config}
	Cli Copy Scp  ${config}  ${scp}
	Cli Reconnect
	Compare Scp  ${config}  ${scp}
	Compare Scp  running-config  ${scp}

T5.5 Copy running config to scp://, copy RC from scp:// to file, verify
	Cli Copy Scp  running-config  ${scp}
	Cli Copy Scp  ${scp}  ${file}
	Compare  running-config  ${file}

T5.6 (?) Copy running config to scp://, copy RC from scp:// to image, verify (negative test case)
	Cli Copy Scp  running-config  ${scp}
	Cli Copy Scp  ${scp}  ${image}

T5.7 Copy running config to config://, copy config:// to scp://, copy from scp:// to file, copy file to config://, copy config:// to RC
	Cli Copy  running-config  ${config}
	Modify Running Config
	Cli Copy  running-config  backup
	Cli Copy Scp  ${config}  ${scp}
	Cli Copy Scp  ${scp}  ${file}
	Cli Copy  ${file}  config://config-new
	Cli Copy  config://config-new  running-config
	Compare  ${config}  running-config
	Compare Negative  backup  running-config


T5.8.1 Verify: compare running-config scp://<running-config>
	Cli Copy Scp  running-config  ${scp RC}
	Compare Scp  running-config  ${scp RC}

T5.8.2 Verify: compare running-config scp://<file>
	Cli Copy  running-config  ${file}
	Cli Copy Scp  ${file}  ${scp file}
	Compare Scp  running-config  ${scp file}

T5.8.3 Verify: compare running-config scp://<config://>
	Cli Copy  running-config  ${config}
	Cli Copy Scp  ${config}  ${scp config}
	Compare Scp  running-config  ${scp config}

T5.8.4 Verify: compare <file> scp://<running-config>
	Cli Copy  running-config  ${file}
	Cli Copy Scp  running-config  ${scp RC}
	Compare Scp  ${file}  ${scp RC}

T5.8.5 Verify: compare <file> scp://<file>
	Cli Copy  running-config  ${file}
	Cli Copy Scp  ${file}  ${scp file}
	Compare Scp  ${file}  ${scp file}

T5.8.6 Verify: compare <file> scp://<config://>
	Cli Copy  running-config  ${file}
	Cli Copy  running-config  ${config}
	Cli Copy Scp  ${config}  ${scp config}
	Compare Scp  ${file}  ${scp config}

T5.8.7 Verify: compare <config://> scp://<running-config>
	Cli Copy  running-config  ${config}
	Cli Copy Scp  running-config  ${scp RC}
	Compare Scp  ${config}  ${scp RC}

T5.8.8 Verify: compare <config://> scp://<file>
	Cli Copy  running-config  ${file}
	Cli Copy  running-config  ${config}
	Cli Copy Scp  ${file}  ${scp file}
	Compare Scp  ${config}  ${scp file}

T5.8.9 Verify: compare <config://> scp://<config://>
	Cli Copy  running-config  ${config}
	Cli Copy Scp  ${config}  ${scp config}
	Compare Scp  ${config}  ${scp config}


T6.1.1 Verify filename containing ~
	Validate Filename  test~test
T6.1.2 Verify filename containing !
	Validate Filename  test!test
T6.1.3 Verify filename containing -
	Validate Filename  test-test
T6.1.4 Verify filename containing _
	Validate Filename  test_test

T6.2.1 Verify config:// name containing ~
	Validate Filename  config://test~test
T6.2.2 Verify config:// name containing !
	Validate Filename  config://test!test
T6.2.3 Verify config:// name containing -
	Validate Filename  config://test-test
T6.2.4 Verify config:// name containing _
	Validate Filename  config://test_test

T6.3 Verify correct processing of special characters in scp:// name (?)
	Cli Reconnect
	Cli Copy Scp  running-config  scp://recovery@10.197.128.37:test#test
	Cli Reconnect
	Compare Scp  running-config  scp://recovery@10.197.128.37:test#test
	Cli Reconnect
	Cli Copy Scp  scp://recovery@10.197.128.37:test#test   running-config

T6.4 Verify empty file name is not allowed
	Run Keyword and Expect Error  *Error: Unexpected end of command*  Cli Copy  running-config  ${EMPTY}

T6.5 Verify empty config:// name is not allowed
	Run Keyword and Expect Error  *Error: Invalid Use: copy: config:// requires a filename after slashes*  Cli Copy  running-config  config://

T6.6 Verify empty scp:// name is not allowed
	Run Keyword and Expect Error  *Error: Invalid Use: No scp path after scp://*  Cli Copy Scp  running-config  scp://

T6.7 Verify scp://scp:// not correct in copy function
	Cli Reconnect
	Run Keyword and Expect Error  *ssh: Could not resolve hostname scp: Name or service not known*  Cli Copy Scp  running-config  ${scp double}
	Cli Reconnect
	Run Keyword and Expect Error  *ssh: Could not resolve hostname scp: Name or service not known*  Cli Copy Scp  ${scp double}  running-config

T6.8 Verify scp://scp:// not correct in compare function
	Cli Reconnect
	Run Keyword and Expect Error  *ssh: Could not resolve hostname scp: Name or service not known*  Cli Compare Scp  running-config  ${scp double}
	Cli Reconnect
	Run Keyword and Expect Error  *ssh: Could not resolve hostname scp: Name or service not known*  Cli Compare Scp  ${scp double}  running-config

T6.9 Verify config://config:// not correct in copy function
	Run Keyword and Expect Error  *Error: Invalid Use: * must not include / *  Cli Copy  running-config  ${config double}
	Run Keyword and Expect Error  *Error: Invalid Use: * must not include / *  Cli Copy  ${config double}  running-config

T6.10 Verify config://config:// not correct in compare function
	Run Keyword and Expect Error  *Error: Invalid Use: * must not include / *  Cli Compare  running-config  ${config double}
	Run Keyword and Expect Error  *Error: Invalid Use: * must not include / *  Cli Compare  ${config double}  running-config

#T6.11 Verify image-double not correct in copy and compare

### and check verifications for empty file names + error messages
T7.1 Verify comparison function between running-config and file
	Cli Copy  running-config  ${file}
	Compare  running-config  ${file}
	Modify Running Config
	Compare Negative  running-config  ${file}

T7.2 Verify comparison function between running-config and config://
	Cli Copy  running-config  ${config}
	Compare  running-config  ${config}
	Modify Running Config
	Compare Negative  running-config  ${config}

T7.3 Verify comparison function between running-config and scp://
	Cli Copy Scp  running-config  ${scp}
	Compare Scp  running-config  ${scp}
	Modify Running Config
	Compare Scp Negative  running-config  ${scp}

T7.4 Verify comparison function between file and config://
	Cli Copy  running-config  ${file}
	Cli Copy  running-config  ${config}
	Compare  ${file}  ${config}
	Modify Running Config
	Cli Copy  running-config  file-new
	Cli Copy  running-config  config://config-new
	Compare Negative  file-new  ${config}
	Compare Negative  ${file}  config://config-new

T7.5 Verify comparison function between file and running-config
	Cli Copy  running-config  ${file}
	Compare  ${file}  running-config
	Modify Running Config
	Compare Negative  ${file}  running-config

T7.6 Verify comparison function between file and scp://
	Cli Copy  running-config  ${file}
	Cli Copy Scp  running-config  ${scp}
	Compare Scp  ${file}  ${scp}
	Modify Running Config
	Cli Copy running-config  file-new
	Cli Copy Scp running-config  scp://recovery@10.197.128.37:config-scp-new
	Compare Scp Negative  file-new  ${scp}
	Compare Scp Negative  ${file}  scp://recovery@10.197.128.37:config-scp-new

T7.7 Verify comparison function between file and file
	Cli Reconnect
	Cli Copy  running-config  file1
	Cli Copy  running-config  file2
	Compare  file1  file2
	Modify Running Config
	Cli Copy  running-config  ${file}
	Compare Negative  file1  ${file}
	Compare Negative  file2  ${file}


T7.8 Verify comparison function between scp:// and config://
	Cli Copy  running-config  ${config}
	Cli Copy Scp  running-config  ${scp}
	Compare Scp  ${config}  ${scp}
	Modify Running Config
	Cli Copy  running-config  config://config-new
	Cli Copy Scp  running-config  scp://recovery@10.197.128.37:config-scp-new
	Compare Scp  config://config-new  scp://recovery@10.197.128.37:config-scp-new
	Compare Scp Negative  config://config-new  ${scp}
	Compare Negative  config://config-new  ${config}

T7.9 Verify comparison function between config:// and config://
	Cli Reconnect
	Cli Copy  running-config  config://config-new1
	Cli Copy  running-config  config://config-new2
	Compare  config://config-new1  config://config-new2
	Modify Running Config
	Cli Copy  running-config  ${config}
	Compare Negative  config://config-new1  ${config}
	Compare Negative  config://config-new2  ${config}

T7.10 Verify comparison function between running-config and inexistent file
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  running-config  inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  inexistent  running-config

T7.11 Verify comparison function between running-config and inexistent config://file
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  running-config  config://inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  config://inexistent  running-config

T7.12 Verify comparison function between running-config and inexistent scp://file
	Run Keyword and Expect Error  *scp: inexistent: No such file or directory*
	...  Cli Compare Scp  running-config  ${scp inexistent}
	Run Keyword and Expect Error  *scp: inexistent: No such file or directory*
	...  Cli Compare Scp  ${scp inexistent}  running-config

T7.13 Verify comparison function between file and inexistent config://file
	Cli Copy  running-config  ${file}
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  ${file}  config://inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  config://inexistent  ${file}

T7.14 Verify comparison function between file and inexistent scp://
	Cli Copy  running-config  ${file}
	Run Keyword and Expect Error  *  Cli Compare Scp  ${file}  ${scp inexistent}
	Run Keyword and Expect Error  *  Cli Compare Scp  ${scp inexistent}  ${file}

T7.15 Verify comparison function between file and inexistent file
	Cli Copy  running-config  ${file}
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  ${file}  inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  inexistent  ${file}

T7.16 Verify comparison function between inexistent file and inexistent file
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent1 does not exist*
	...  Cli Compare  inexistent1  inexistent2

T7.17 Verify comparison function between config://file and inexistent file
	Cli Copy  running-config  ${config}
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  ${config}  inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare  inexistent  ${config}

T7.18 Verify comparison function between config://file and inexistent scp://
	Cli Copy  running-config  ${config}
	Run Keyword and Expect Error  *scp: inexistent: No such file or directory*
	...  Cli Compare Scp  ${config}  ${scp inexistent}
	Cli Reconnect
	Run Keyword and Expect Error  *scp: inexistent: No such file or directory*
	...  Cli Compare Scp  ${scp inexistent}  ${config}

T7.19 Verify comparison function between config://file and inexistent config://
	Cli Copy  running-config  ${config}
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  ${config}  config://inexistent
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare  config://inexistent  ${config}

T7.20 Verify comparison function between inexistent config://file and inexistent config://
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent1 does not exist*
	...  Cli Compare  config://inexistent1  config://inexistent2

T7.21 Verify comparison function between scp:// and inexistent file
	Cli Copy Scp  running-config  ${scp}
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare Scp  ${scp}  inexistent
	Cli Reconnect
	Run Keyword and Expect Error  *Error: Invalid Use: inexistent does not exist*
	...  Cli Compare Scp  inexistent  ${scp}

T7.22 Verify comparison function between scp:// and inexistent config://file
	Cli Copy Scp  running-config  ${scp}
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare Scp  ${scp}  config://inexistent
	Cli Reconnect
	Run Keyword and Expect Error  *Error: Invalid Use: config://inexistent does not exist*
	...  Cli Compare Scp  config://inexistent  ${scp}


T8.1 Verify deletion of file
	Cli Copy  running-config  ${file}
	Cli Delete  ${file}

T8.2 Verify deletion of inexistent file
	Run Keyword and Expect Error  *Error: Invalid Use: File "*" not found*  Cli Delete  inexistent

T8.3 Verify deletion of config://file
	Cli Copy  running-config  ${config}
	Cli Delete  ${config}

T8.4 Verify deletion of inexistent config://file
	Run Keyword and Expect Error  *Error: Invalid Use: * does not exist*  Cli Delete  config://inexistent

#T9.1 Verify impossible to copy to invalid SCP
	#Cli Copy Scp  running-config  scp://invalid
	#Cli Copy Scp  running-config  scp://scp-no-colon@1.2.3.4
#T9.1 Verify impossible to copy from invalid SCP
#T9.2 Verify impossible to compare with invalid SCP


#???T7.9 Verify comparison function between scp:// and image://


*** Keywords ***
Generate Random Name
	[Arguments]  ${prefix}  ${suffix_len}
    ${regex}  Generate Random String  ${suffix_len}  [NUMBERS]
    ${name}  Catenate  SEPARATOR=  ${prefix}  ${regex}
    [Return]  ${name}

Setup
	Base Test Setup
	Modify Running Config

Modify Running Config
	${tenant}  Generate Random Name  Tenant  5
	Rest Add Tenant  ${tenant}

Teardown
	Cli Reconnect
	Bash Clear Known Hosts
	Cli Copy  config://startup-config  running-config
	Cli Reconnect
	Base Test Teardown

Compare
	[Arguments]  ${first}  ${second}
	${status} =  Cli Compare  ${first}  ${second}
	Should Be True  ${status}
	${status} =  Cli Compare  ${second}  ${first}
	Should Be True  ${status}

Compare Negative
	[Arguments]  ${first}  ${second}
	${status} =  Cli Compare  ${first}  ${second}
	Should Not Be True  ${status}
	${status} =  Cli Compare  ${second}  ${first}
	Should Not Be True  ${status}

Compare Scp
	[Arguments]  ${first}  ${second}
	Cli Reconnect
	${status} =  Cli Compare Scp  ${first}  ${second}
	Should Be True  ${status}
	Cli Reconnect
	${status} =  Cli Compare Scp  ${second}  ${first}
	Should Be True  ${status}

Compare Scp Negative
	[Arguments]  ${first}  ${second}
	Cli Reconnect
	${status} =  Cli Compare Scp  ${first}  ${second}
	Should Not Be True  ${status}
	Cli Reconnect
	${status} =  Cli Compare Scp  ${second}  ${first}
	Should Not Be True  ${status}

Compare RC with File Line By Line
	[Arguments]  ${file}
	${status} =  Cli Compare Running Config with File Line By Line  ${file}
	Should Be True  ${status}

Compare RC with File Line By Line Negative
	[Arguments]  ${file}
	${status} =  Cli Compare Running Config with File Line By Line  ${file}
	Should Not Be True  ${status}

Compare RC with Config Line By Line
	[Arguments]  ${file}
	${status} =  Cli Compare Running Config with Config Line By Line  ${file}
	Should Be True  ${status}

Compare RC with Config Line By Line Negative
	[Arguments]  ${file}
	${status} =  Cli Compare Running Config with Config Line By Line  ${file}
	Should Not Be True  ${status}

Validate Filename
	[Arguments]  ${file}
	Cli Copy  running-config  ${file}
	Compare  running-config  ${file}
	Cli Copy  ${file}  running-config
	Cli Delete  ${file}
	Run Keyword and Expect Error  *Error: Invalid Use:*not*  Cli Delete  ${file}
