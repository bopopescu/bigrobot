*Settings
Documentation  BigTap Switch Port Channel Test Suite
Suite Setup  lag suite setup
Suite Teardown   base suite teardown
Test Setup  base test setup
Test Teardown  base test teardown
Force Tags  SNMP Sanity
Library  keywords/BsnCommon.py
Library  keywords_dev/BsnCommonConfig.py
Library  keywords_dev/BsnCommonShow.py
Library  keywords_dev/BsnSwitchCommon.py

* Variable
${ip_address_1}  10.192.75.7
${ip_address_2}  10.192.75.213
${ip_address_3}  10.192.75.214
${switchlight_version}  SwitchLight 2.0.0-beta1


*Test Case
Verify port-channel (hash-mode:L3) interface (10G links) is up on switch (LB9)  
	verify lag-10glb9-up
	
Verify port-channel (hash-mode:L3) interface shows correct 10G member links on switch (LB9)  
	verify lagmem-10glb9   

Verify port-channel (hash-mode:L3) interface 10G member links are up on switch (LB9)  
	verify lagmem-10glb9-up

Verify port-channel (hash-mode:L3) interface (10G links) is up on switch (LY2)  
	verify lag-10gly2-up
	
Verify port-channel (hash-mode:L3) interface shows correct 10G member links on switch (LY2)  
	verify lagmem-10gly2    

Verify port-channel (hash-mode:L3) interface 10G member links are up on switch (LY2)  
	verify lagmem-10gly2-up

Verify port-channel (hash-mode:L3) interface (40G links) is up on switch (LY2)  
	verify lag-40gly2-up
	
Verify port-channel (hash-mode:L3) interface shows correct 40G member links on switch (LY2)  
	verify lagmem-40gly2    

Verify port-channel (hash-mode:L3) interface 40G member links are up on switch (LY2)  
	verify lagmem-40gly2-up

Verify port-channel (hash-mode:L2) interface (10G links) is up on switch (LB9)  
	verify l2-lag-10glb9-up
	
Verify port-channel (hash-mode:L2) interface shows correct 10G member links on switch (LB9)  
	verify l2-lagmem-10glb9   

Verify port-channel (hash-mode:L2) interface 10G member links are up on switch (LB9)  
	verify l2-lagmem-10glb9-up

Verify port-channel (hash-mode:L2) interface (10G links) is up on switch (LY2)  
	verify l2-lag-10gly2-up
	
Verify port-channel (hash-mode:L2) interface shows correct 10G member links on switch (LY2)  
	verify l2-lagmem-10gly2    

Verify port-channel (hash-mode:L2) interface 10G member links are up on switch (LY2)  
	verify l2-lagmem-10gly2-up

Verify port-channel (hash-mode:L2) interface (40G links) is up on switch (LY2)  
	verify l2-lag-40gly2-up
	
Verify port-channel (hash-mode:L2) interface shows correct 40G member links on switch (LY2)  
	verify l2-lagmem-40gly2    

Verify port-channel (hash-mode:L2) interface 40G member links are up on switch (LY2)  
	verify l2-lagmem-40gly2-up

T5829-1: Verify that when portchannel interface cannot be formed if member links have mismatched speeds (1G and 10G)
	verify T5829-1g10g

T5829-2: Verify that when portchannel interface cannot be formed if member links have mismatched speeds (10G and 40G)
	verify T5829-10g40g

* Keywords  
lag suite setup
	configure portchannel  ${ip_address_1}  1  49-50  L3         
	configure portchannel  ${ip_address_2}  7  43,44  L3   
	configure portchannel  ${ip_address_2}  30  49,52  L3
	configure portchannel  ${ip_address_3}  30  49,52  L3  
	sleepnow   30

verify lag-10glb9-up 
# Verify portchannel interface is up
	${inft_state}=  return intf state  ${ip_address_1}  port-channel1
	Should Contain  ${inft_state}  up

verify lagmem-10glb9
# Verify portchannel interface correctly reports member interface name
	${member_exists1}=  verify portchannel members  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_exists1}
	${member_exists2}=  verify portchannel members  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_exists2}

verify lagmem-10glb9-up
# Verify portchannel interface correctly reports member interfaces as up
	${member_isup1}=  verify portchannel member state  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_isup1}
	${member_isup2}=  verify portchannel member state  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_isup2}

verify lag-10gly2-up
# Verify portchannel interface is up
	${inft_state}=  return intf state  ${ip_address_2}  port-channel7
	Should Contain  ${inft_state}  up

verify lagmem-10gly2
# Verify portchannel interface correctly reports member interface name
	${member_exists3}=  verify portchannel members  ${ip_address_2}  7  ethernet43
	Should Be True  ${member_exists3}
	${member_exists4}=  verify portchannel members  ${ip_address_2}  7  ethernet44
	Should Be True  ${member_exists4}

verify lagmem-10gly2-up
# Verify portchannel interface correctly reports member interfaces as up
	${member_isup3}=  verify portchannel member state  ${ip_address_2}  7  ethernet43
	Should Be True  ${member_isup3}
	${member_isup4}=  verify portchannel member state  ${ip_address_2}  7  ethernet44
	Should Be True  ${member_isup4}

verify lag-40gly2-up
# Verify portchannel interface is up
	${inft_state}=  return intf state  ${ip_address_2}  port-channel30
	Should Contain  ${inft_state}  up

verify lagmem-40gly2
# Verify portchannel interface correctly reports member interface name
	${member_exists5}=  verify portchannel members  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_exists5}
	${member_exists6}=  verify portchannel members  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_exists6}

verify lagmem-40gly2-up
# Verify portchannel interface correctly reports member interfaces as up
	${member_isup5}=  verify portchannel member state  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_isup5}
	${member_isup6}=  verify portchannel member state  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_isup6}

verify l2-lag-10glb9-up 
# Verify portchannel interface is up
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${inft_state}=  return intf state  ${ip_address_1}  port-channel1
	Should Contain  ${inft_state}  up

verify l2-lagmem-10glb9
# Verify portchannel interface correctly reports member interface name
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${member_exists1}=  verify portchannel members  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_exists1}
	${member_exists2}=  verify portchannel members  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_exists2}

verify l2-lagmem-10glb9-up
# Verify portchannel interface correctly reports member interfaces as up
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${member_isup1}=  verify portchannel member state  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_isup1}
	${member_isup2}=  verify portchannel member state  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_isup2}

verify l2-lag-10gly2-up
# Verify portchannel interface is up
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${inft_state}=  return intf state  ${ip_address_2}  port-channel7
	Should Contain  ${inft_state}  up

verify l2-lagmem-10gly2
# Verify portchannel interface correctly reports member interface name
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${member_exists3}=  verify portchannel members  ${ip_address_2}  7  ethernet43
	Should Be True  ${member_exists3}
	${member_exists4}=  verify portchannel members  ${ip_address_2}  7  ethernet44
	Should Be True  ${member_exists4}

verify l2-lagmem-10gly2-up
# Verify portchannel interface correctly reports member interfaces as up
	configure portchannel  ${ip_address_1}  1  49-50  L2         
	configure portchannel  ${ip_address_2}  7  43,44  L2
	sleepnow   5
	${member_isup3}=  verify portchannel member state  ${ip_address_2}  7  ethernet43
	Should Be True  ${member_isup3}
	${member_isup4}=  verify portchannel member state  ${ip_address_2}  7  ethernet44
	Should Be True  ${member_isup4}

verify l2-lag-40gly2-up
# Verify portchannel interface is up
	configure portchannel  ${ip_address_2}  30  49,52  L2
	configure portchannel  ${ip_address_3}  30  49,52  L2 
	${inft_state}=  return intf state  ${ip_address_2}  port-channel30
	Should Contain  ${inft_state}  up

verify l2-lagmem-40gly2
# Verify portchannel interface correctly reports member interface name
	configure portchannel  ${ip_address_2}  30  49,52  L2
	configure portchannel  ${ip_address_3}  30  49,52  L2 
	${member_exists5}=  verify portchannel members  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_exists5}
	${member_exists6}=  verify portchannel members  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_exists6}

verify l2-lagmem-40gly2-up
# Verify portchannel interface correctly reports member interfaces as up
	configure portchannel  ${ip_address_2}  30  49,52  L2
	configure portchannel  ${ip_address_3}  30  49,52  L2 
	${member_isup5}=  verify portchannel member state  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_isup5}
	${member_isup6}=  verify portchannel member state  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_isup6}

verify T5829-1g10g
#  	Verify that when portchannel interface cannot be formed if member links have mismatched speeds
	configure portchannel  ${ip_address_1}  1  48,49,50  L3
	sleepnow   10
	${inft_state}=  return intf state  ${ip_address_1}  port-channel1
	Should Contain  ${inft_state}  up
	${member_exists0}=  verify portchannel members  ${ip_address_1}  1  ethernet48
	Should Be True  ${member_exists0}
	${member_exists1}=  verify portchannel members  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_exists1}
	${member_exists2}=  verify portchannel members  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_exists2}
	${member_isup0}=  verify portchannel member state  ${ip_address_1}  1  ethernet48
	Should Not Be True  ${member_isup0}
	${member_isup1}=  verify portchannel member state  ${ip_address_1}  1  ethernet49
	Should Be True  ${member_isup1}
	${member_isup2}=  verify portchannel member state  ${ip_address_1}  1  ethernet50
	Should Be True  ${member_isup2}
	configure portchannel  ${ip_address_1}  1  49,50  L3
	sleepnow   10

verify T5829-10g40g
#  	Verify that when portchannel interface cannot be formed if member links have mismatched speeds (10g and 40g)
	configure portchannel  ${ip_address_2}  30  4,49,52  L3
	sleepnow   30
	${inft_state}=  return intf state  ${ip_address_2}  port-channel30
	Should Contain  ${inft_state}  up
	${member_exists0}=  verify portchannel members  ${ip_address_2}  30  ethernet4
	Should Be True  ${member_exists0}
	${member_exists1}=  verify portchannel members  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_exists1}
	${member_exists2}=  verify portchannel members  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_exists2}
	${member_isup0}=  verify portchannel member state  ${ip_address_2}  30  ethernet4
	Should Not Be True  ${member_isup0}
	${member_isup1}=  verify portchannel member state  ${ip_address_2}  30  ethernet49
	Should Be True  ${member_isup1}
	${member_isup2}=  verify portchannel member state  ${ip_address_2}  30  ethernet52
	Should Be True  ${member_isup2}
	configure portchannel  ${ip_address_2}  30  49,52  L3
	sleepnow   30

snmp test teardown
	REST delete snmp