*Settings
Documentation  Controller SNMP Sanity Test Suite
Suite Setup  snmp suite setup
Suite Teardown   snmp suite teardown
Test Setup   base test setup
Test Teardown   base test teardown
Force Tags   SNMP Sanity
Library  keywords/BsnCommon.py
Library   keywords_dev/animesh/BsnCommonConfig.py
Library  keywords_dev/animesh/BsnCommonShow.py
Library  keywords_dev/animesh/BsnSwitchCommon.py
Library   keywords_dev/animesh/BigTapCommonShow.py
Library   keywords_dev/animesh/BigTapCommonConfig.py

* Variable
${sysDescr}  Big Wire Controller

*Test Case
Configure and Verify Configuration  
	verify config
	
Verify SNMP OID sysContact  
	verify sysContact      

Verify SNMP OID sysLocation  
	verify sysLocation      

Verify SNMP OID sysDescr  
	verify sysDescr      

Verify SNMP OID ifDescr
	verify ifDescr      

Verify SNMP OID ifType
	verify ifType      

Verify SNMP OID ifAdminStatus
	verify ifAdminStatus      

Verify SNMP OID ifOperStatus
	verify ifOperStatus      

Modify SNMP Community and Verify SNMP OID sysContact
	modify community      

Verify on deleting location information from SNMP, sysLocation returns Unknown
	delete location      

Verify snmpgetnext works as expected
	verify snmpgetnext      

Verify snmpbulkget works as expected
	verify snmpbulkget      

Verify snmpbulkwalk works as expected
	verify snmpbulkwalk      

	[Tags]   sanity

 
* Keywords  
snmp suite setup
	${controllerID}=  rest controller id
	rest firewall allow snmp  ${controllerID}
	REST set snmp server community  public
	REST set snmp server contact  Big Switch Networks
	REST set snmp server location  Mountain View
	REST set snmp server enable
	REST set snmp trapserver  10.192.3.22  161
	REST enable snmp trapserver
	Sleep  2

verify config
	${snmp_output}=  REST snmp show
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  community
	Should Be Equal As Strings  ${snmp_key}  public
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  contact
	Should Be Equal As Strings  ${snmp_key}  Big Switch Networks
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  location
	Should Be Equal As Strings  ${snmp_key}  Mountain View
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  server-enable
	Should Be True  ${snmp_key}
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  trap-server
	Should Be Equal As Strings  ${snmp_key}  10.192.3.22
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  trap-port
	Should Be Equal As Integers  ${snmp_key}  161
	${snmp_key}=  REST verify dict key  ${snmp_output}  0  trap-enable
	Should Be True  ${snmp_key}

verify sysContact
	${snmp_key}=  REST snmp get  public  sysContact.0
	Should Contain  ${snmp_key}  Big Switch Networks

verify sysLocation
	${snmp_key}=  REST snmp get  public  sysLocation.0
	Should Contain  ${snmp_key}  Mountain View

verify sysDescr
	${snmp_key}=  REST snmp get  public  sysDescr.0
	Should Contain  ${snmp_key}  ${sysDescr}

verify ifDescr
	${snmp_key}=  REST snmp get  public  ifDescr.2
	Should Contain  ${snmp_key}  eth0

verify ifType
	${snmp_key}=  REST snmp get  public  ifType.2
	Should Contain  ${snmp_key}  ethernetCsmacd

verify ifAdminStatus
	${snmp_key}=  REST snmp get  public  ifAdminStatus.2
	Should Contain  ${snmp_key}  up

verify ifOperStatus
	${snmp_key}=  REST snmp get  public  ifOperStatus.2
	Should Contain  ${snmp_key}  up

modify community
	REST modify snmp key  community  bigswitch 
	${snmp_key}=  REST snmp get  bigswitch  sysContact.0
	Should Contain  ${snmp_key}  Big Switch Networks
	REST modify snmp key  community  public 
	${snmp_key}=  REST snmp get  public  sysContact.0
	Should Contain  ${snmp_key}  Big Switch Networks 
	${snmp_key}=  REST snmp get  public  ifOperStatus.2
	Should Contain  ${snmp_key}  up

delete location
	REST modify snmp key  location  null 
	${snmp_key}=  REST snmp get  public  sysLocation.0
	Should Contain  ${snmp_key}  Unknown
	REST modify snmp key  location  Mountain View 
	${snmp_key}=  REST snmp get  public  sysLocation.0
	Should Contain  ${snmp_key}  Mountain View

verify snmpgetnext
	${snmp_key}=  REST snmp getnext  public  ifDescr.1
	Should Contain  ${snmp_key}  eth0

verify snmpbulkget
	${snmp_key}=  REST snmp cmd  snmpbulkget  -Cr2  public  ifDescr 
	Should Contain  ${snmp_key}  eth0

verify snmpbulkwalk
	${snmp_key}=  REST snmp cmd  snmpbulkwalk  None  public  ifDescr 
	Should Contain  ${snmp_key}  eth0

snmp suite teardown
	rest delete snmp trapserver  161
	Run Keyword And Ignore Error  rest delete snmp
