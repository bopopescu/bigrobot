== T5 Sanity Test Suite ==

* Setting
Documentation    T5 Dual Leaf Three Rack Test Suite
Suite Setup      base suite setup
Suite Teardown   base suite teardown
Test Setup       T5 base test setup
Test Teardown    T5 base test teardown
Force Tags       T5 
Library          keywords/BsnCommon.py
Library          keywords_dev/T5.py
Library	         keywords_dev/T5Fabric.py
Library          keywords/Mininet.py
Library	    	 keywords/Host.py
Resource		 keywords_dev/t5_dualleaf_three_rack_physical_resource.txt

* Variables
${bm3_ip}  192.168.0.11
${bm4_ip}  192.168.0.30
${bm5_ip}  192.168.0.31
${bm0_tag_mac}  90:e2:ba:4e:bc:98
${bm1_tag_mac}  90:e2:ba:4f:80:b1
${bm2_tag_mac}  00:10:18:f0:eb:e0
${bm3_mac}	00:10:18:f0:e9:70
${bm4_mac}	90:e2:ba:4f:80:dc
${bm5_mac}	90:e2:ba:4e:bb:90
${bm0_intf0}  ethernet48
${bm0_intf1}  ethernet48
${bm1_intf0}  ethernet47
${bm1_intf1}  ethernet47
${bm2_intf0}  ethernet1
${bm2_intf1}  ethernet1
${bm3_intf0}  ethernet2
${bm3_intf1}  ethernet2
${bm4_intf0}  ethernet48
${bm4_intf1}  ethernet48
${bm5_intf0}  ethernet47
${bm5_intf1}  ethernet47
${bm0_tag_ip}	192.168.4.20
${bm1_tag_ip}	192.168.4.21
${bm2_tag_ip}	192.168.4.10

* Test Case 

Configure Fabric setup Three Rack Dual Leaf 
   [Tags]  smoke  sanity
   sleep  5
   configure fabric switch
   sleep  5
   rest check fabric switch connectivity
   rest verify fabric link 

ping bm0 to bm1 dual leaf single rack dynamic endpoints
   [Tags]  smoke  sanity  
   add portgroup to vns  A  A  p5  -1 
   add portgroup to vns  A  A  p6  -1
   sleep  10 
   ${loss}=  bash ping  h5  ${bm5_ip}  source_if=bond0
   Should Be True  ${loss} == 0						 
	 
ping bm0 to bm1 dual leaf single rack static endpoints
   [Tags]  sanity  
   create a endpoint  A  A  e1 
   create a endpoint  A  A  e2 
   add portgroup to endpoint  A   A  e2  p6  -1
   add portgroup to endpoint  A   A  e1  p5  -1
   REST configure ip endpoint  A  A  e1  ${bm4_ip}
   REST configure mac endpoint  A  A  e1  ${bm4_mac}
   REST configure ip endpoint  A  A  e2  ${bm5_ip}
   REST configure mac endpoint  A  A  e2  ${bm5_mac}
   add portgroup to vns  A  A  p6  -1 
   add portgroup to vns  A  A  p5  -1
   sleep  20
   ${loss}=  bash ping  h5  ${bm5_ip}  source_if=bond0
   Should Be True  ${loss} == 0 

ping bm0 to bm2 dual rack dual leaf dynamic endpoints
   [Tags]  sanity  
   add portgroup to vns  A  A  p6  -1 
   add portgroup to vns  A  A  p4  -1
   sleep  10 
   ${loss}=  bash ping  h5  ${bm3_ip}  source_if=bond0
   Should Be True  ${loss} == 0					 
		
ping bm0 to bm2 dual rack dual leaf static endpoints
   [Tags]  sanity       
   create a endpoint  A  A  e1 
   create a endpoint  A  A  e2 
   add portgroup to endpoint  A   A  e2  p6  -1
   add portgroup to endpoint  A   A  e1  p4  -1
   REST configure ip endpoint  A  A  e1  ${bm4_ip}
   REST configure mac endpoint  A  A  e1  ${bm4_mac}
   REST configure ip endpoint  A  A  e2  ${bm3_ip}
   REST configure mac endpoint  A  A  e2  ${bm3_mac}
   add portgroup to vns  A  A  p6  -1 
   add portgroup to vns  A  A  p4  -1 
   sleep  10
   ${loss}=  bash ping  h5  ${bm3_ip}  source_if=bond0
   Should Be True  ${loss} == 0  
   
ping bm0 to bm1 dual leaf single rack dynamic endpoints tag
   [Tags]  sanity  
   add portgroup to vns  A  A  p1  10 
   add portgroup to vns  A  A  p2  10 
   sleep  10
   ${loss}=  bash ping  h1  ${bm1_tag_ip}  source_if=bond0.10
   Should Be True  ${loss} == 0 					
		
ping bm0 to bm1 dual leaf single rack static endpoints tag
   [Tags]  sanity  
   create a endpoint  A  A  e1 
   add portgroup to endpoint  A  A  e1  p1  10
   create a endpoint  A  A  e2 
   add portgroup to endpoint  A  A  e2  p2  10
   REST configure ip endpoint  A  A  e1  ${bm0_tag_ip}
   REST configure mac endpoint  A  A  e1  ${bm0_tag_mac}
   REST configure ip endpoint  A  A  e2  ${bm1_tag_ip}
   REST configure mac endpoint  A  A  e2  ${bm1_tag_mac}
   add portgroup to vns  A  A  p2  10 
   add portgroup to vns  A  A  p1  10
   sleep  10 
   ${loss}=  bash ping  h1  ${bm1_tag_ip}  source_if=bond0.10
   Should Be True  ${loss} == 0

ping bm0 to bm2 dual rack dual leaf dynamic endpoints tag     
   [Tags]  sanity  
   add portgroup to vns  A  A  p1  10 
   add portgroup to vns  A  A  p3  10 
   sleep  10
   ${loss}=  bash ping  h1  ${bm2_tag_ip}  source_if=bond0.10
   Should Be True  ${loss} == 0   
   
ping bm0 to bm2 dual rack dual leaf static endpoints tag 
   [Tags]  sanity  
   create a endpoint  A  A  e1  
   add portgroup to endpoint  A  A  e1  p1  10
   create a endpoint  A  A  e2 
   add portgroup to endpoint  A  A  e2  p3  10 
   REST configure ip endpoint  A  A  e1  ${bm0_tag_ip}
   REST configure mac endpoint  A  A  e1  ${bm0_tag_mac}
   REST configure ip endpoint  A  A  e2  ${bm2_tag_ip}
   REST configure mac endpoint  A  A  e2  ${bm2_tag_mac}
   add portgroup to vns  A  A  p3  10 
   add portgroup to vns  A  A  p1  10
   sleep  10
   ${loss}=  bash ping  h1  ${bm2_tag_ip}  source_if=bond0.10
   Should Be True  ${loss} == 0  
   
Tear down the config
   [Tags]  smoke  sanity 
   delete a tenant  A 
   delete interface from portgroup  leaf0-a  ${bm0_intf0}  p1
   delete interface from portgroup  leaf0-b  ${bm0_intf1}  p1
   delete interface from portgroup  leaf0-a  ${bm1_intf0}  p2
   delete interface from portgroup  leaf0-b  ${bm1_intf1}  p2
   delete interface from portgroup  leaf1-a  ${bm2_intf0}  p3 
   delete interface from portgroup  leaf1-b  ${bm2_intf1}  p3 
   delete interface from portgroup  leaf0-a  ${bm3_intf0}  p4
   delete interface from portgroup  leaf0-b  ${bm3_intf1}  p4
   delete interface from portgroup  leaf0-a  ${bm4_intf0}  p5
   delete interface from portgroup  leaf0-b  ${bm4_intf1}  p5
   delete interface from portgroup  leaf1-a  ${bm5_intf0}  p6 
   delete interface from portgroup  leaf1-b  ${bm5_intf1}  p6 
   delete a portgroup  p1
   delete a portgroup  p2
   delete a portgroup  p3
   delete a portgroup  p4
   delete a portgroup  p5
   delete a portgroup  p6
   remove fabric switch
   

* Keywords

T5 base test setup
   base test setup
   create a tenant  A 
   create a vns  A  A
   create a portgroup  p1 
   add interface to portgroup  leaf0-a  ${bm0_intf0}  p1
   add interface to portgroup  leaf0-b  ${bm0_intf1}  p1
   create a portgroup  p2 
   add interface to portgroup  leaf0-a  ${bm1_intf0}  p2
   add interface to portgroup  leaf0-b  ${bm1_intf1}  p2
   create a portgroup  p3 
   add interface to portgroup  leaf1-a  ${bm2_intf0}  p3
   add interface to portgroup  leaf1-b  ${bm2_intf1}  p3
   create a portgroup  p4 
   add interface to portgroup  leaf1-a  ${bm3_intf0}  p4
   add interface to portgroup  leaf1-b  ${bm3_intf1}  p4
   create a portgroup  p5 
   add interface to portgroup  leaf2-a  ${bm4_intf0}  p5
   add interface to portgroup  leaf2-b  ${bm4_intf1}  p5
   create a portgroup  p6 
   add interface to portgroup  leaf2-a  ${bm5_intf0}  p6
   add interface to portgroup  leaf2-b  ${bm5_intf1}  p6
   sleep  5
   
T5 base test teardown
   delete a tenant  A
   delete interface from portgroup  leaf0-a  ${bm0_intf0}  p1
   delete interface from portgroup  leaf0-b  ${bm0_intf1}  p1
   delete interface from portgroup  leaf0-a  ${bm1_intf0}  p2
   delete interface from portgroup  leaf0-b  ${bm1_intf1}  p2
   delete interface from portgroup  leaf1-a  ${bm2_intf0}  p3 
   delete interface from portgroup  leaf1-b  ${bm2_intf1}  p3
   delete interface from portgroup  leaf1-a  ${bm0_intf0}  p4
   delete interface from portgroup  leaf1-b  ${bm0_intf1}  p4
   delete interface from portgroup  leaf2-a  ${bm1_intf0}  p5
   delete interface from portgroup  leaf2-b  ${bm1_intf1}  p5
   delete interface from portgroup  leaf2-a  ${bm2_intf0}  p6 
   delete interface from portgroup  leaf2-b  ${bm2_intf1}  p6  
   delete a portgroup  p1
   delete a portgroup  p2
   delete a portgroup  p3
   delete a portgroup  p4
   delete a portgroup  p5
   delete a portgroup  p6
   base test teardown
   sleep  5
         
create a tenant  [Arguments]  ${tenant} 
  REST create tenant  ${tenant}    

delete a tenant  [Arguments]  ${tenant} 
  	REST delete tenant  ${tenant}    

create a vns  [Arguments]  ${tenant}  ${vns}  
	REST create vns  ${tenant}  ${vns}   

delete a vns  [Arguments]  ${tenant}  ${vns} 
  	REST delete vns  ${tenant}  ${vns}   

create a portgroup  [Arguments]  ${pg}
  	REST create portgroup  ${pg}    

delete a portgroup  [Arguments]  ${pg}
  	REST delete portgroup  ${pg}    

create a endpoint  [Arguments]  ${tenant}  ${vns}  ${endpoint} 
  	REST create endpoint  ${tenant}  ${vns}  ${endpoint}  

delete a endpoint  [Arguments]  ${tenant}  ${vns}  ${endpoint}
  	REST delete endpoint  ${tenant}  ${vns}  ${endpoint}  

add interface to portgroup  [Arguments]  ${switch}  ${intf}  ${pg} 
  	REST add interface to portgroup  ${switch}  ${intf}  ${pg}  

delete interface from portgroup  [Arguments]  ${switch}  ${intf}  ${pg} 
  	REST delete interface from portgroup  ${switch}  ${intf}  ${pg}  

add portgroup to vns  [Arguments]  ${tenant}  ${vns}  ${pg}  ${vlan}
  	REST add portgroup to vns  ${tenant}  ${vns}  ${pg}  ${vlan} 

add portgroup to endpoint  [Arguments]  ${tenant}  ${vns}  ${endpoint}  ${pg}  ${vlan} 
  REST add portgroup to endpoint  ${tenant}  ${vns}  ${endpoint}  ${pg}  ${vlan} 

delete portgroup from vns  [Arguments]  ${tenant}  ${vns}  ${pg}  ${vlan} 
  REST delete portgroup from vns  ${tenant}  ${vns}  ${pg}  ${vlan}
  


 
